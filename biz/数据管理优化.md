[TOC]

# ç—›ç‚¹ï¼šå¼€å‘&ç»´æŠ¤
è¿™é‡Œä»¥ä¸€ä¸ªæŠ½è±¡åœºæ™¯è¯´æ˜ç—›ç‚¹ã€‚

ç°åœ¨æˆ‘ä»¥ä¸€ä¸ªæœ€åŸå§‹çš„ç»„ä»¶åšè¯´æ˜ã€æ²¡æœ‰å°è£…é‡å¤ä»£ç ã€‘
```js
function App(props){
    const [state,setState] = useState({data:null,loading:true,error:null})
    
    useEffect(()=>{
        setState({data:null,loading:true,error:null})
        
        fetch(url,id)
        .then((res)=>{
            setState({data:res.data,loading:false,error:null})
        })
        .catch((e)=>{
            setState({data:null,loading:false,error:e.message})
        })
    },[doFetch,props.id]);
    
    return <>
        loading 
        ? <Loader/>
        : error 
        ? <Error/>
        : <Children/>
    </>
}
```
å®¡è§†ä¸€ä¸‹è¿™ä¸ªç»„ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å“ªäº›é—®é¢˜ï¼Ÿã€éœ€è¦è¯´ä¸€ä¸‹çš„æ˜¯ï¼Œå‡½æ•°å¼ç»„ä»¶å·²ç»æ˜¯åšäº†ä¼˜åŒ–äº†ï¼Œå¦‚æœæ˜¯ç±»ç»„ä»¶å†™æ³•æ›´éº»çƒ¦ï¼Œå› ä¸ºéœ€è¦åœ¨`DidMount`é˜¶æ®µåŠ è½½ä¸€æ¬¡ï¼Œåœ¨`DidUpdate`äººå·¥åˆ¤æ–­å¹¶è§†æƒ…å†µè¿›è¡ŒåŠ è½½ï¼Œè¿™ç§äººå·¥åˆ¤æ–­ä¾èµ–çš„æƒ…å†µæ˜¾ç„¶æ˜¯ä¸é è°±çš„ï¼Œç„¶åå¾ˆæ˜æ˜¾ä¸€ç‚¹æ˜¯ç›¸åŒé€»è¾‘æˆ–è€…è¯´ä»£ç åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡ºç°äº†ï¼Œè¿™ç§åˆ†æ•£ä¹Ÿæ˜¯ä¸€ç§è´Ÿæ‹…ã€‘
1. ğŸ‘**é‡å¤çš„æ¨¡æ¿ä»£ç **ï¼šå®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¼šå‘ç°è¯·æ±‚æ•°æ®çš„ç›¸å…³å¤„ç†æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºè¯·æ±‚çš„å‚æ•°ï¼ˆè¿™ä¸ªä¹Ÿå¾ˆå®¹æ˜“æŠ½ç¦»æˆå…¬å…±æ–¹æ³•ï¼Œå®é™…ä¸Šæˆ‘ä»¬é¡¹ç›®é‡Œå·²ç»æŠ½ç¦»äº†ã€‘
1. ğŸ‘**æ•°æ®å’ŒUIè€¦åˆ**ï¼šæ•°æ®æ˜¯åœ¨ç»„ä»¶å†…éƒ¨è·å–çš„ï¼Œè¿™å°±è®©ç»„ä»¶çš„å¤ç”¨å˜å¾—å›°éš¾ï¼Œæ¯”å¦‚è¯´ç°åœ¨å­˜åœ¨ä¸åŒç»„ä»¶ä¾èµ–ç›¸åŒæ•°æ®çš„æƒ…å†µï¼Œé‚£ä¹ˆè¿™ç§å†™æ³•å°±ä¼šå‡ºç°é‡å¤çš„è°ƒç”¨ã€‚ï¼ˆè¿™ç§æƒ…å†µå®¢è§‚å­˜åœ¨ï¼Œåœ¨é¡¹ç›®é‡Œæˆ‘çœ‹åˆ°è¿‡é¡µé¢é¦–æ¬¡åŠ è½½è¯·æ±‚äº†6æ¬¡å®Œå…¨ç›¸åŒçš„æ¥å£ï¼‰
1. ğŸ‘**ç³Ÿç³•çš„ä¸‰å…ƒè¡¨è¾¾å¼**ï¼šè¿™é‡Œçœ‹ä¼¼åªæœ‰ä¸€ä¸ªè¿”å›ï¼Œå®é™…ä¸Šæœ‰ä¸‰ç§æƒ…å†µï¼Œå®ƒéœ€è¦æ‰¿æ‰¿æ‹…ä¸‰ä»½è´£ä»»ï¼Œé˜…è¯»å’Œç»´æŠ¤çš„æˆåŠŸå¾ˆé«˜

## ç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼šæŠ½ç¦»é‡å¤ä»£ç 
è¿™ä¸ªä¼˜åŒ–æ˜¯æœ€å¸¸è§çš„ï¼Œæˆ‘ä»¬ç°åœ¨æŠ½ç¦»ä¸€ä¸ª`useFetch`æ–¹æ³•

```js
function useFetch(){
    const [state,setState] = useState({data:null,loading:true,error:null})
    
    const doFetch = useCallback((url,id)=>{
        setState({data:null,loading:true,error:null})

        fetch(url,id)
        .then((res)=>{
            setState({data:res.data,loading:false,  error:null})
        })
        .catch((e)=>{
            setState({data:null,loading:false,error:e.  message})
        })
    },[]);

    return {...state,doFetch}
}
```

ç„¶åæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šå†æ¬¡å®ç°åŸæ¥ç»„ä»¶ï¼š
```js
function App(props){
    const {data,loading,error,doFetch} = useFetch();
    
    useEffect(() => {
        if(props.id) doFetch(url,props.id);
    },[doFetch,props.id])
    
    return <>
        {
            loading 
            ? <Loader/>
            : error
            ? <Error/>
            : <Children/>
        }
    </>
}
```
å¯ä»¥çœ‹åˆ°ï¼Œä»£ç å¹²å‡€äº†å¾ˆå¤šï¼Œç„¶åæˆ‘ä»¬è§£å†³å¦å¤–ä¸¤ä¸ªé—®é¢˜ã€‚

## ç¬¬äºŒæ¬¡ä¼˜åŒ–ï¼šè§£å†³è€¦åˆ
é¦–å…ˆçœ‹ä¸€ä¸‹è¿˜éœ€è¦è§£å†³çš„é—®é¢˜ï¼š
1. æ•°æ®å’ŒUIè€¦åˆåˆ°ä¸€èµ·ï¼Œå¯¼è‡´UIçš„éƒ¨åˆ†ä¸èƒ½ç‹¬ç«‹ä½¿ç”¨
1. æ•°æ®çš„å¤ç”¨é—®é¢˜

å’ŒUIçš„é—®é¢˜æ˜¯æ¯”è¾ƒå¥½çš„è§£å†³ï¼Œæ¯”è¾ƒç›´æ¥çš„æ–¹æ¡ˆæ˜¯å°†ç»„ä»¶åšæˆå®Œå…¨å—æ§ç»„ä»¶ï¼Œä¸è¿‡è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜ï¼Œæ•°æ®æ”¾åœ¨å“ªé‡Œå¤„ç†ï¼Ÿ
### ç›´æ¥åœ¨çˆ¶ç»„ä»¶è·å–æ•°æ®
è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºï¼šæ˜æ˜æ˜¯å­ç»„ä»¶éœ€è¦ä½¿ç”¨çš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¦åœ¨çˆ¶ç»„ä»¶å¤„ç†ï¼Ÿ

è¿™ç§åšæ³•ä¼šä½¿å¾—çˆ¶ç»„ä»¶æ‰¿æ‹…ä¸è¯¥æ‰¿æ‹…çš„è´£ä»»ã€‚å‡è®¾çˆ¶ç»„ä»¶çš„å­ç»„ä»¶æ¯”è¾ƒå¤šï¼Œå‡è®¾ç°åœ¨çˆ¶ç»„ä»¶æœ‰åä¸ªå­ç»„ä»¶ï¼Œé‚£ä¹ˆéœ€è¦åœ¨çˆ¶ç»„ä»¶ä¸­è¿›è¡Œåç§æ•°æ®çš„è·å–ï¼Ÿåœ¨åŠ ä¸Šçˆ¶ç»„ä»¶è‡ªå·±çš„çŠ¶æ€å’Œé€»è¾‘ï¼Œçˆ¶ç»„ä»¶ä¼šå˜å¾—éå¸¸å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ï¼Œè€Œä¸”æˆ‘ä»¬ä¿®æ”¹å…¶ä¸­ä»»æ„ä¸€ä¸ªå­ç»„ä»¶çš„æ•°æ®è·å–é€»è¾‘ï¼Œéƒ½ä¼šå½±å“åˆ°å…¶ä»–æ‰€æœ‰å­ç»„ä»¶ä»¥åŠçˆ¶ç»„ä»¶æœ¬èº«ï¼Œå› ä¸ºè¿™äº›é€»è¾‘å’ŒçŠ¶æ€å¤„ç†åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚

å®é™…ä¸Šï¼Œè¿™ç§æƒ…å†µåœ¨é¡¹ç›®ä¸­ä¹Ÿæ˜¯å®¢è§‚å­˜åœ¨çš„ï¼Œè€Œä¸”è¶Šæ˜¯å¤æ‚çš„é¡µé¢è¶Šæ˜¯å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µã€‚

### å•ç‹¬æŠ½ç¦»ä¸€å±‚è·å–æ•°æ®
å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆå¯èƒ½æ¯”è¾ƒå¸¸è§ï¼Œè€Œä¸”åŠ ä¸Šè£…é¥°å™¨è¯­æ³•ï¼Œå½¢æˆæ–°ç»„ä»¶ä¹Ÿç®€å•ï¼Œä¸€ä¸ªç»„ä»¶ç”¨äºè·å–æ•°æ®ï¼Œä¸€ä¸ªç»„ä»¶ç”¨äºæ¸²æŸ“ã€‚æœ‰äº›æƒ…å†µä¸‹è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ã€å¦‚æœæ•°æ®ä¸éœ€è¦å¤ç”¨çš„è¯ã€‘

è¿™ç§åšæ³•åœ¨ç»„ä»¶é“¾æ¡ä¸Šä¼šå¢åŠ ä¸€æ¡ï¼Œä¸è¿‡èŒè´£æ›´æ¸…æ™°ï¼Œç›®å‰æˆ‘è®¤ä¸ºè¿™ç§åšæ³•ä¾æ—§æ˜¯ä¼˜ç‚¹å¤§äºç¼ºç‚¹çš„ã€è¿™ç§åšæ³•æ˜¯è£…é¥°å™¨æ¨¡å¼ã€‘

### å°†æ•°æ®æŠ½ç¦»æˆå…¬å…±`hook`ä½¿ç”¨
å’ŒHOCç»„ä»¶å…¶å®æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œç¼ºé™·ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

## ç¬¬ä¸‰æ¬¡ä¼˜åŒ–ï¼šå¤ç”¨æ•°æ®
### `props`
è¿™åº”è¯¥æ˜¯æˆ‘ä»¬é¡¹ç›®ç›®å‰å­˜åœ¨æœ€å¤šçš„æ–¹å¼äº†ï¼Œä¸è¿‡å®é™…æˆ‘çš„æ„Ÿå—æ¥è¯´ï¼Œç»´æŠ¤èµ·æ¥å¾ˆæ¶å¿ƒã€‚

å±‚å±‚ä¼ é€’å¤ªå½±å“å¿ƒæ€äº†ï¼Œä¸€æ—¦è¦å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æŸä¸ª`prop`ï¼Œéƒ½è¦å¤„ç†å¥½å‡ å±‚ï¼Œä¸€æ—¦æŸä¸€å±‚å¤„ç†é—æ¼äº†ï¼Œæ•´ä¸ªé€»è¾‘å°±ä¼šå‡ºé—®é¢˜ã€‚

è€Œä¸”å¦ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„é—®é¢˜æ˜¯ï¼Œå‡è®¾äº§ç”Ÿæ•°æ®çš„ç»„ä»¶æ˜¯Aï¼Œä½¿ç”¨æ•°æ®çš„ç»„ä»¶æ—¶Fï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿™ä¹ˆä¼ é€’`A->B->C->D->E->F`ï¼Œä¸­é—´è¿™äº›ç»„ä»¶ä¼šæ¥æ”¶å¾ˆå¤šä¸€äº›è‡ªå·±ç”¨ä¸åˆ°çš„`prop`ï¼Œè€Œä¸”éšç€é“¾æ¡çš„å¢é•¿å¤šä½™çš„`prop`è¶Šå¤šï¼Œæ¯”å¦‚è¿™é‡Œçš„`B`æœ‰å››å±‚å­çº§ï¼Œå››å±‚å­çº§çœŸæ­£çš„å­å­™ç»„ä»¶å¯èƒ½å¤šè¾¾æ•°åç§å¯èƒ½ï¼Œ`B`ç»„ä»¶è¿™ä¸ªä¸­è½¬ç«™å¯èƒ½åªéœ€è¦æ¥å—ä¸¤ä¸‰ä¸ª`props`è¿›è¡Œä½¿ç”¨ï¼Œç„¶è€Œå®é™…ä¸Šå®ƒå´æ¥å—äº†äºŒåå¤šä¸ª`props`ï¼Œç„¶åå®ƒçš„ä¸‹ä¸€çº§ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¥å—äº†åå‡ äºŒåä¸ª`props`ï¼Œè¿™ç§å°±éå¸¸è¦å‘½ï¼Œå¿ƒæ™ºè´Ÿæ‹…å’Œç»´æŠ¤æˆæœ¬éƒ½æé«˜ã€ä¸æ˜¯å¼€ç©ç¬‘ï¼Œå®é™…é¡¹ç›®ä»£ç é‡ŒçœŸçš„æœ‰è¿™ç§ä¼ é€’äº†äºŒåå¤šä¸ª`props`çš„ï¼Œè€Œä¸”è¿˜ä¼ äº†å¥½å‡ å±‚ã€‘

### `Context`
`Context`æ˜¯`React`å®˜æ–¹æ¨å‡ºçš„ä¸€ç§æ•°æ®å¤ç”¨æ–¹æ¡ˆï¼ˆä¸è¿‡ä¹Ÿæœ‰ä¸€äº›è´Ÿæ‹…ï¼‰

æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ç§å†™æ³•åœºæ™¯ï¼š
```js
function View(){
    const [count,setCount] = useState(0);
    const [header,setHeader] = useState('aaa');

    useEffect(()=>{
        setCount(c => c+1)
    },[header])

    const value = {
        data1:useData1(),
        data2:useData2(),
        data3:useData3()
        //...
    }
    return <Context.Provider value={value}>
        <Card header={header}>
            <Children count={count} setCount={setCount}>{/*æ·±å±‚åµŒå¥—*/}
        </Card>
    </Context.Provider>
}
```
çœ‹ä¸€ä¸‹è¿™ç§åšæ³•çš„ä¼˜ç¼ºç‚¹ï¼š
1. ğŸ‘ **æ•°æ®è·å–ç®€å•**ï¼šæ•°æ®ä¸éœ€è¦å±‚å±‚ä¼ é€’ï¼Œå¯ä»¥åœ¨å­å­™ç»„ä»¶ç§ç›´æ¥è·å–
2. ğŸ‘ **é¦–æ¬¡åŠ è½½è´Ÿè·å¤§**ï¼šè¿™ç§åšæ³•çš„ç¡®å‡å°‘äº†æ€»çš„è¯·æ±‚æ¬¡æ•°ï¼Œæ²¡æœ‰é‡å¤çš„è¯·æ±‚ã€‚ä½†æ˜¯ç°åœ¨è¿™ç§åšæ³•ï¼Œé¦–æ¬¡ä¼šåŠ è½½æ‰€æœ‰çš„æ•°æ®ï¼Œæœ‰çš„æ•°æ®å¯èƒ½æš‚æ—¶æ²¡æœ‰ç”¨åˆ°ï¼Œæ¯”å¦‚è¯´å®ƒæ˜¯åœ¨å¼¹çª—æ‰“å¼€åä½¿ç”¨çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™è¯·æ±‚æ˜¯å¤šä½™çš„è´Ÿæ‹…ã€‚
3. ğŸ‘ **æ ¹ç»„ä»¶èŒè´£è¿‡å¤š**ï¼šè¿™é‡Œè™½ç„¶å°†æ•°æ®è·å–çš„é€»è¾‘æ‹†å–å‡ºå»äº†ï¼Œä½†æ˜¯è·å–å­å­™å…¬å…±æ•°æ®çš„é€»è¾‘è¿˜æ˜¯ç”±`View`è¿™ä¸ªæ ¹ç»„ä»¶è´Ÿè´£ï¼Œè¿™ç§åšæ³•å¹¶ä¸åˆç†ã€‚
   1. é¦–å…ˆæ˜¯èŒèƒ½æ··ä¹±çš„é—®é¢˜ï¼Œè¿™é‡ŒViewç»„ä»¶æ‰¿æ‹…äº†ä¸‰ç§èŒè´£ï¼šæä¾›ä¸Šä¸‹æ–‡ã€è·å–å…¬å…±æ•°æ®ã€UIç›¸å…³çš„çŠ¶æ€åŠé€»è¾‘ï¼Œä¸‰ç§èŒè´£æ··åˆåˆ°ä¸€èµ·å°†é€ æˆé˜…è¯»å’Œç»´æŠ¤ä¸Šçš„å›°éš¾ã€‚
   2. Viewæ˜¯æ ¹ç»„ä»¶ï¼Œå¯¹å…¶è¿›è¡Œçš„å¤„ç†å½±å“åˆ°çš„å†…å®¹æ›´åŠ å¹¿æ³›ï¼Œä¹Ÿå¢åŠ äº†ç»´æŠ¤çš„è´Ÿæ‹…
4. ğŸ‘ **å…¬å…±ç»„ä»¶èŒè´£é”™è¯¯**ï¼šï¼ˆä¸»è¦æ˜¯ç¬¬ä¸‰ç‚¹ï¼‰
   1. æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯çš„èŒè´£æ˜¯æœ€ä¸Šå±‚çš„ï¼Œå› ä¸ºå®ƒå…¬å…±ä¸”è„±ç¦»ä¸šåŠ¡ï¼Œéœ€è¦å•ç‹¬æŠ½ç¦»ä¸€ä¸ª`Provider`ç»„ä»¶å¤„ç†
   2. `View`çš„é€»è¾‘çŠ¶æ€å•ç‹¬ä¸€å±‚å¤„ç†
   3. è€Œç¬¬ä¸‰ä»½è´£ä»»è·å–å…¬å…±æ•°æ®å¹¶ä¸åº”è¯¥ç”±å…¬å…±ç»„ä»¶å¤„ç†ï¼Œå³ä½¿å•ç‹¬ç”¨ä¸€ä¸ªå…¬å…±ç»„ä»¶è¿›è¡Œå…¬å…±æ•°æ®çš„è·å–ï¼Œè¿˜æ˜¯ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºåœ¨é¡¶å±‚æ˜¯éš¾ä»¥é¢„æ–™åˆ°å­å­™å±‚éƒ¨åˆ†å¯¹æ•°æ®çš„ä½¿ç”¨å’Œæ§åˆ¶çš„ã€‚ä»¥ç°åœ¨çš„è¿™ç§åšæ³•ä¸¾ä¾‹ï¼Œæˆ‘åœ¨é¡¶å±‚æä¾›ä¸€ä¸ªå…¬å…±æ•°æ®`data1`ï¼Œå®ƒåŸæœ¬æ˜¯è¢«å‡ ä¸ªç»„ä»¶å…¬å…±ä½¿ç”¨çš„ï¼Œç°åœ¨å› ä¸ºä¸šåŠ¡çš„ä¸æ–­å˜åŒ–ï¼Œè¿™å‡ ä¸ªç»„ä»¶è¢«ç§»é™¤äº†æˆ–è€…ä½¿ç”¨äº†å…¶ä»–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´`data1`ä¸éœ€è¦äº†ï¼Œé‚£æˆ‘é¡¶å±‚æ€ä¹ˆçŸ¥é“å®ƒä¸éœ€è¦äº†å‘¢ï¼Ÿåè¿‡æ¥ï¼Œå­å­™å±‚ç”±æ•°ç™¾ä¸Šåƒä¸ªç»„ä»¶æ„æˆï¼Œå…¶ä¸­ä¸€ä¸¤ä¸ªç»„ä»¶éœ€è¦ä½¿ç”¨çš„æ•°æ®æ”¾ä¸æ”¾åˆ°é¡¶å±‚ï¼Ÿæ”¾ï¼Œåˆ™é¡¶å±‚å¯èƒ½å­˜åœ¨æ•°åä¸Šç™¾ä¸ªæ•°æ®çš„è·å–ï¼Œå‹åŠ›å¾ˆå¤§ä¸”æ²¡å¿…è¦ã€‚ä¸æ”¾ï¼Œåˆ™é‡å¤è¯·æ±‚çš„é—®é¢˜ä¼šå­˜åœ¨ã€‚

ä¸Šé¢è¿™ç§ä¸Šä¸‹æ–‡æ•°æ®å…±äº«çš„åšæ³•å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç±»ä¼¼çš„å†™æ³•è¿˜æ˜¯æ³¨æ„ä¸€ä¸‹ã€‚

ç®€å•æè¿°ä¸‹æˆ‘ä»¬æƒ³ä¼˜åŒ–çš„ç‚¹ï¼š
1. â¤ï¸ ä¸æå‰è·å–æ•°æ®ï¼Œä¿è¯æœ€ä¼˜çš„é€»è¾‘å’Œæ€§èƒ½
2. â¤ï¸ `Provider`ç»„ä»¶æä¾›æ•°æ®ä¸Šä¸‹æ–‡ï¼Œæ•°æ®çš„è·å–äº¤ç»™ä¸šåŠ¡ç›¸å…³çš„ç»„ä»¶ï¼Œä¿è¯ä»£ç ç»´æŠ¤æ€§
3. â¤ï¸ æ¯ä¸ªç»„ä»¶è´£ä»»åˆ’åˆ†æ›´æ¸…æ™°
4. â¤ï¸ ä»¥ä¸Šå‰æä¸‹ï¼Œç›¸åŒçš„æ¥å£åªè¯·æ±‚ä¸€æ¬¡ï¼Œä¿è¯æ•°æ®çš„å¤ç”¨

### Contextä¼˜åŒ–æ–¹æ¡ˆ
é¦–å…ˆæç‚¼ä¸€ä¸ª`RootProvider`ç»„ä»¶ï¼š
```js
function RootProvider(props){
    const [data,setData] = useState({});

    const doFetch = useCallback((url)=>{
        if(data[url]) return data[url];
        
        data[url] = {data:null,loading:true,error:null};
        setData({...data});

        fetch(url)
        .then((res)=>{
            data[url] = {data:res.data, loading:false,  error:null};
            setData({...data});
        })
        .catch((e)=>{
            data[url] = {data:null, loading:false, error:e.message};
            setData({...data});
        })
    },[])

    return <Context.Provider value={{doFetch,data}}>{props.children}</Context.Provider>
}
```

åœ¨å­å­™ç»„ä»¶ä¸­ä½¿ç”¨ï¼š
```js
const url = 'www.baidu.com'
function App(){
    const {doFetch,data} = useRoot();
    doFetch(url);
    const appData = data[url];

    return <>use appData</>
}
```
è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¹‹å‰æƒ³è¦ä¼˜åŒ–çš„ç‚¹ï¼š
1. ğŸ‘ ä¸æå‰è·å–æ•°æ®ï¼Œä¿è¯æœ€ä¼˜çš„é€»è¾‘å’Œæ€§èƒ½
2. ğŸ‘ `Provider`ç»„ä»¶æä¾›æ•°æ®ä¸Šä¸‹æ–‡ï¼Œæ•°æ®çš„è·å–äº¤ç»™ä¸šåŠ¡ç›¸å…³çš„ç»„ä»¶ï¼Œä¿è¯ä»£ç ç»´æŠ¤æ€§
3. ğŸ‘ æ¯ä¸ªç»„ä»¶è´£ä»»åˆ’åˆ†æ›´æ¸…æ™°
4. ğŸ‘ ä»¥ä¸Šå‰æä¸‹ï¼Œç›¸åŒçš„æ¥å£åªè¯·æ±‚ä¸€æ¬¡ï¼Œä¿è¯æ•°æ®çš„å¤ç”¨

æœ‰ä¸€ç‚¹éœ€è¦è¯´ä¸€ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼çš„å®ç°å…¶å®å¹¶ä¸ä¸€å®šè¦å€ŸåŠ©äº`Context`ï¼Œ`Context`ã€`localStorage`ã€`Redux`ã€å…¨å±€å¯¹è±¡ï¼ˆ`window`æˆ–è€…è‡ªå®šä¹‰`cache`å®ä¾‹ï¼‰éƒ½å¯ä»¥ï¼Œå¹¶ä¸æ‹˜æ³¥äºå½¢å¼ã€‚

å®é™…ä¸Šæˆ‘ä»¬ç°åœ¨é¡¹ç›®ä¸­æœ‰ä¸€éƒ¨åˆ†æ•°æ®å°±æ˜¯è¿™ä¹ˆç¼“å­˜çš„ï¼Œé€šè¿‡è‡ªå®šä¹‰å…¨å±€`cache`å®ä¾‹çš„æ–¹å¼è¿›è¡Œä¿å­˜ã€‚

è¿™ä¸ªç¼“å­˜æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­è·å–ä¸€ä»½æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ç¼“å­˜ï¼Œåˆ™è¿”å›æ•°æ®ç¼“å­˜ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›è¡Œæ•°æ®è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª`Promise`ã€‚

åœ¨è§£æ`Promise`ä¹‹å‰ï¼Œå®ƒå°†è·å–çš„æ•°æ®å­˜å‚¨åœ¨å®ƒ**ç”¨äºç¼“å­˜çš„ä»»ä½•å†…å®¹ä¸­**ï¼Œè¿™æ ·å½“`React`è§¦å‘é‡æ–°æ¸²æŸ“æ—¶ï¼Œæ•°æ®å¯ä»¥è¢«å¤ç”¨ã€‚è€ƒè™‘åˆ°ç¼“å­˜å¤±æ•ˆå’ŒSSRç­‰é—®é¢˜ï¼Œåœ¨å®é™…åœºæ™¯ä¸­å¯èƒ½æ›´åŠ å¤æ‚ï¼Œä¸è¿‡åŸºæœ¬çš„å®ç°æ˜¯ç±»ä¼¼çš„ã€‚

`React`å®˜æ–¹ä¹Ÿç»™å‡ºäº†æ–¹æ¡ˆ`react-cache`ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„æ–¹æ¡ˆ

### `react-cache`
#### ä½¿ç”¨
é¦–å…ˆçœ‹ä¸€ä¸‹æ˜¯æ€ä¹ˆä½¿ç”¨çš„ã€è¿™ä¸ªéœ€è¦ç»“åˆ`Suspense`ç»„ä»¶ï¼Œ`Suspense`çš„ä½¿ç”¨æˆ‘ä¼šåœ¨ä¸‹é¢è¯´æ˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¼˜åŒ–ç‚¹ã€‘ï¼š
```js
import React,{Suspense} from 'react';
import {createResource} from './react-cache';
import axios from 'axios';

const textResource = createResource(()=>axios.get('https://v1.hitokoto.cn/'))

function CacheView() {
    return <Suspense fallback={"Loading..."}>
        <AsyncText/>
        <AsyncText/>
        <AsyncText/>
        <AsyncText/>
    </Suspense>
}

export default CacheView;

function AsyncText(){
    const result = textResource.read();
    return <div>
        {result.data.hitokoto}
    </div>
}
```
å®é™…è¿è¡Œä¹‹åï¼Œå¯ä»¥å‘ç°ï¼Œæœ‰å››ä¸ªå­ç»„ä»¶ï¼Œä½†æ˜¯åªè¿›è¡Œäº†ä¸€ä»½æ•°æ®è¯·æ±‚ï¼Œå››ä¸ªå­ç»„ä»¶çš„æ•°æ®æ˜¯å®Œå…¨ç›¸åŒçš„ã€è¢«å¤ç”¨äº†ã€‘ã€‚

å…³äº`react-cache`æˆ‘æœ‰å‡ ç‚¹éœ€è¦è¯´ä¸€ä¸‹ï¼š
1. å®˜æ–¹è™½ç„¶å‘å¸ƒäº†`react-cache`è¿™ä¸ªåŒ…ï¼Œå¦‚æœç›´æ¥è¿è¡Œä¼šæŠ¥é”™ï¼ŒæŸ¥äº†äº›ç›¸å…³èµ„æ–™ï¼š
   1. [issues/14780](https://github.com/facebook/react/issues/14780) å®˜æ–¹å¼€å‘è€…åœ¨é‡Œé¢å›å¤äº†ï¼Œç›®å‰å¸Œæœ›ä½¿ç”¨çš„æ–¹å¼æ˜¯æ‹·è´æºç åœ¨æœ¬åœ°å®ç°ï¼Œå› ä¸ºç¼“å­˜ç­–ç•¥åœ¨æœªæ¥å¯èƒ½æœ‰æ‰€å˜åŒ–ï¼Œç›®å‰çš„å®˜æ–¹ç¼“å­˜æ–¹æ¡ˆå¹¶æ²¡æœ‰å†³å®šä¸‹æ¥
   2. [/issues/14575](https://github.com/facebook/react/issues/14575) è¿™é‡Œæœ‰äººç»™å‡ºäº†ä¿®æ”¹æ–¹æ¡ˆï¼Œæˆ‘æ”¹äº†ä¹‹åå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œå¹¶ä¸”ç¬¦åˆé¢„æœŸæ•ˆæœ
2. ç›®å‰çš„å®ç°å¹¶ä¸ä¾èµ–`Context`ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç»„ä»¶ä¹‹å¤–ä½¿ç”¨ï¼Œä½†æ˜¯å®˜æ–¹å»ºè®®ã€æºç æ³¨é‡Šé‡Œå†™çš„ã€‘ç›´åˆ°ç¼“å­˜ç­–ç•¥ç¡®è®¤ä¹‹å‰ï¼Œè¯·ä¿è¯åªåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ã€‚

#### å®ç°åŸç†
> æºç ç‰ˆæœ¬æ˜¯ï¼š17.0.2

##### `createResource`
æˆ‘ä»¬ä»å…¥å£`createResource`è¿›å…¥ï¼š
```ts
export function unstable_createResource<I, K: string | number, V>(
  fetch: I => Thenable<V>,
  maybeHashInput?: I => K,
): Resource<I, V> {
  const hashInput: I => K =
    maybeHashInput !== undefined ? maybeHashInput : (identityHashFn: any);

  const resource = {
    read(input: I): V {
      // ç°åœ¨çš„å®ç°å¹¶ä¸ä¾èµ–äºContextï¼Œè¿™ä¸€è¡Œç°åœ¨æ²¡å•¥ç”¨ï¼Œä½†æ˜¯å®˜æ–¹å¸Œæœ›æˆ‘ä»¬åªåœ¨æ¸²æŸ“æ—¶è°ƒç”¨ï¼Œä»¥åº”å¯¹æœªæ¥çš„å˜åŒ–
      readContext(CacheContext);
      const key = hashInput(input);
      const result: Result<V> = accessResult(resource, fetch, input, key);
      switch (result.status) {
        //...æ ¹æ®çŠ¶æ€è¿”å›ä¸åŒå€¼ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†é…åˆSuspenseç»„ä»¶ä½¿ç”¨
      }
    },

    preload(input: I): void {
      //...
    },
  };
  return resource;
}
```
è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ã€‚<br/>
å‚æ•°ï¼š
- `fetch` å¿…å¡«ï¼Œå‡½æ•°ç±»å‹ï¼Œè¦æ±‚è¿”å›å€¼æ˜¯`Thenable`ç±»å‹
- `maybeHashInput` å¯é€‰ï¼Œå‡½æ•°ç±»å‹ï¼Œç”¨äºç”Ÿæˆ`key`ï¼Œæ²¡ä¼ åˆ™ä½¿ç”¨å†…ç½®å‡½æ•°

è¿”å›å€¼ï¼šä¸€ä¸ª`Resource`ç±»å‹å€¼ï¼Œè¿™æ˜¯`Resource`çš„å®šä¹‰ï¼š
```ts
type Resource<I, V> = {
  read(I): V,
  preload(I): void,
  ...
};
```

å› ä¸ºå½“å‰çš„ç¼“å­˜æµ‹è¯•å¹¶ä¸ä¾é ä¸Šä¸‹ï¼Œç°åœ¨çœŸæ­£çš„ç¼“å­˜å®ç°æ˜¯`accessResult`æ–¹æ³•

###### `accessResult`

```ts
const entries: Map<Resource<any, any>, Map<any, any>> = new Map();

function accessResult<I, K, V>(
  resource: any,
  fetch: I => Thenable<V>,
  input: I,
  key: K,
): Result<V> {
  let entriesForResource = entries.get(resource);
  
  if (entriesForResource === undefined) {
    entriesForResource = new Map();
    entries.set(resource, entriesForResource);
  }
  
  const entry = entriesForResource.get(key);

  if (entry === undefined) {
    const thenable = fetch(input);
    thenable.then(
      value => {
        if (newResult.status === Pending) {
          const resolvedResult: ResolvedResult<V> = (newResult: any);
          resolvedResult.status = Resolved;
          resolvedResult.value = value;
        }
      },
      error => {
        if (newResult.status === Pending) {
          const rejectedResult: RejectedResult = (newResult: any);
          rejectedResult.status = Rejected;
          rejectedResult.value = error;
        }
      },
    );
    const newResult: PendingResult = {
      status: Pending,
      value: thenable,
    };

    const newEntry = lru.add(newResult, deleteEntry.bind(null, resource, key));
    entriesForResource.set(key, newEntry);
    return newResult;
  } else {
    return (lru.access(entry): any);
  }
}
```
ä¸»è¦æ€æƒ³ä¹Ÿå¾ˆç®€å•ï¼šå¦‚æœæœ‰ç¼“å­˜ï¼Œè¿”å›ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜åˆ™æ·»åŠ åè¿”å›ç¼“å­˜ã€‚

è¿™é‡Œæœ‰ä¸€äº›çœ‹èµ·æ¥å¥‡æ€ªçš„åšæ³•ï¼š
1. è¿™ä¸ª`lru`æ˜¯ä»€ä¹ˆï¼Ÿ
2. å·²ç»ä½¿ç”¨äº†`Map`è¿›è¡Œå­˜å‚¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦`lru`ï¼Ÿ

æ³¨æ„åˆ°è¿™é‡Œï¼Œæ‰æ˜¯æ•´ä¸ªç¼“å­˜ç­–ç•¥æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚åœ¨å±•ç¤º`lru`æºç ä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸‹`LRU`ç®—æ³•

##### `LRU`ç®—æ³•
`LRU` æ˜¯ `Least Recently Used` çš„ç¼©å†™ï¼Œè¿™æ˜¯ä¸€ç§ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå› ä¸ºå†…å­˜æœ‰é™ï¼Œä¸å¯èƒ½æ— é™åˆ¶çš„è¿›è¡Œç¼“å­˜ï¼Œæ‰€ä»¥åˆ°è¾¾ä¸Šé™æ˜¯éœ€è¦åˆ é™¤ä¸€éƒ¨åˆ†ç¼“å­˜ã€‚

é—®é¢˜æ˜¯ï¼Œåˆ é™¤å“ªä¸€éƒ¨åˆ†å†…å®¹ï¼Ÿæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½åˆ é™¤å“ªäº›æ²¡ç”¨çš„æ•°æ®ï¼Œ`LRU`ç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨æ·˜æ±°ç­–ç•¥ï¼Œå®ƒè®¤ä¸ºæœ€è¿‘ä½¿ç”¨åˆ°çš„æ•°æ®æ˜¯â€œæœ‰ç”¨çš„**ï¼Œå¾ˆä¹…æ²¡è¢«ä½¿ç”¨çš„æ•°æ®æ˜¯â€œæ²¡ç”¨çš„â€ã€‚

`LRU`å®é™…ä¸Šéœ€è¦æˆ‘ä»¬è®¾è®¡ä¸€ç§æ•°æ®ç»“æ„ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„æ•°æ®ç»“æ„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼š
1. â¤ï¸ æŸ¥æ‰¾å¿«
2. â¤ï¸ æ’å…¥å¿«
3. â¤ï¸ åˆ é™¤å¿«
4. â¤ï¸ æœ‰é¡ºåºä¹‹åˆ†ï¼šä»¥åŒºåˆ†æœ€è¿‘ä½¿ç”¨å’Œé•¿ä¹…æ²¡ç”¨çš„æ•°æ®

æœ‰å“ªäº›æ•°æ®ç»“æ„ç¬¦åˆä¸Šè¿°æ¡ä»¶
- **å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—è¡¨ï¼‰**ï¼šæŸ¥æ‰¾å¿«ï¼Œä½†æ˜¯æ•°æ®æ— å›ºå®šé¡ºåº
- **é“¾è¡¨**ï¼šæœ‰é¡ºåºä¹‹åˆ†ï¼Œæ’å…¥åˆ é™¤å¿«ï¼Œä½†æ˜¯æŸ¥æ‰¾æ…¢

å°†å“ˆå¸Œè¡¨å’Œé“¾è¡¨ç»“åˆä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®ç»“æ„äº†ï¼Œå§‘ä¸”ç§°ä¹‹ä¸ºå“ˆå¸Œé“¾è¡¨ã€‚

è¿™ä¸ªæ•°æ®ç»“æ„çš„APIä¸€èˆ¬ä¼šæœ‰è¿™ä¹ˆä¸‰ä¸ªï¼ˆå¿½ç•¥åç§°ï¼Œçœ‹ä½œç”¨ï¼‰ï¼š
- `setLimit` è®¾ç½®ç¼“å­˜å¤§å°
- `add` æ·»åŠ æ–°æ•°æ®
- `access` è®¿é—®æ—§æ•°æ®

`LRU`çš„ä¸»è¦è¡Œä¸ºåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š
1. å¿«é€ŸæŸ¥çœ‹æ˜¯å¦å·²æœ‰çš„ç¼“å­˜
2. æ–°æ•°æ®ï¼Œåˆ™æ’å…¥é“¾è¡¨å¤´éƒ¨
3. ç¼“å­˜æ•°æ®ï¼Œå°†æ•°æ®ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨
4. ç¼“å­˜è¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œç§»é™¤é“¾è¡¨å°¾éƒ¨ç¼“å­˜

å®ç°è¿™ä¸ªåŠŸèƒ½ä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨ï¼Œå› ä¸ºå•å‘é“¾è¡¨ä¸èƒ½å¿«é€Ÿè·å–å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œåœ¨å°†ä¸­é—´èŠ‚ç‚¹ç§»åŠ¨åˆ°å¤´èŠ‚ç‚¹æ—¶ï¼Œä¸å¾—ä¸éå†è·å–ä¿¡æ¯ï¼Œå¤æ‚åº¦ä¸º`O(n)`ï¼Œè€ŒåŒå‘é“¾è¡¨åšè¿™ä¸ªæ“ä½œçš„å¤æ‚åº¦æ˜¯`O(1)`

è®©æˆ‘ä»¬æ€»ç»“ä¸‹ç°åœ¨å“ˆå¸ŒåŒå‘é“¾è¡¨åœ¨å„ç§æ“ä½œæ—¶çš„è¡¨ç°ï¼š
1. ğŸ‘ **æŸ¥æ‰¾**ï¼š`O(1)`
1. ğŸ‘ **æ’å…¥**ï¼š`O(1)`
1. ğŸ‘ **åˆ é™¤**ï¼š`O(1)`
1. ğŸ‘ **ç§»åŠ¨**ï¼š`O(1)`

è¯·çœ‹æ•°æ®ç»“æ„å›¾ï¼š
![æ•°æ®ç»“æ„å›¾](https://pic.leetcode-cn.com/b84cf65debb43b28bd212787ca63d34c9962696ed427f638763be71a3cb8f89d.jpg)

æœ‰äººå¯èƒ½ä¼šé—®çš„é—®é¢˜ï¼šæ—¢ç„¶å“ˆå¸Œè¡¨é‡Œå·²ç»å­˜äº†`key`ï¼Œé‚£ä¹ˆé“¾è¡¨ç›´æ¥å­˜`value`å°±å¥½ï¼Œä¸ºä»€ä¹ˆè¿˜å¥½å­˜`key`å‘¢ï¼Ÿ<br/>
å› ä¸ºåˆ é™¤é“¾è¡¨æ•°æ®çš„æ—¶å€™ï¼Œè¿˜éœ€è¦åˆ é™¤å“ˆå¸Œè¡¨ä¸­çš„æ˜ å°„ï¼Œåˆ é™¤å“ˆå¸Œè¡¨çš„æ˜ å°„éœ€è¦`key`ï¼Œåªæœ‰`value`åˆ™æ— æ³•è¿›è¡Œå“ˆå¸Œè¡¨çš„åˆ é™¤ã€‚

`LRU`æºç è¿™é‡Œå°±ä¸å±•ç¤ºäº†ï¼Œæºç åœ¨`packages/react-cache/src/LRU.js`æ–‡ä»¶

## ç¬¬å››æ¬¡ä¼˜åŒ–ï¼šèŒè´£æ‹†åˆ†-åŠ è½½ã€é”™è¯¯å¤„ç†
é¦–å…ˆè¦è¯´ä¸€ä¸‹ï¼Œä¹‹å‰ä¸‰å…ƒçš„é—®é¢˜ä¸ä»…æ˜¯ä¹¦å†™å½¢å¼çš„é—®é¢˜ï¼Œæ”¹æˆç®€æ´çš„ä¹¦å†™ä¹Ÿä¸èƒ½è§£å†³æœ¬è´¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨çŸ­è·¯æ“ä½œçš„æ‰‹æ³•ä¼˜åŒ–ä¸‹ï¼š
```js
if(loading) return <Loader/>
if(error) return <Error/>
return <Children>
```
è¿™ç§å†™æ³•é˜…è¯»è´Ÿæ‹…ä¼šä½ä¸€äº›ï¼Œä¸è¿‡æ²¡æœ‰è§£å†³æœ¬è´¨ä¸Šçš„é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯ï¼šä¸åº”è¯¥ç”±`App`å¯¹`loading`ã€`error`è¿›è¡Œæ§åˆ¶ã€‚

å½“ç„¶ï¼Œå¦‚æœæ”¹æˆè®©ä¸€ä¸ªä¸“é—¨çš„ç»„ä»¶ï¼Œæ¯”å¦‚`Card`è´Ÿè´£ï¼Œå…¶å®ä¹Ÿåªæ˜¯å°†é—®é¢˜è½¬ç§»ä¸º`Card`ï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®é‡Œçš„åšæ³•ï¼š
```js
return <Card error={error} loading={loading}>
  <Children>
</Card>
```
æˆ‘ä»¬å†™çš„æ—¶å€™ä¸éœ€è¦åœ¨æ¯ä¸ªç»„ä»¶é‡å¤åˆ¤æ–­äº†ï¼Œä¸è¿‡å®é™…ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ï¼Œæ¯”å¦‚è¯´ï¼š

```jsx
function App(){
  const {data1,loading1} = useGet(1);
  const {data2,loading2} = useGet(2);
  const {data3,loading3} = useGet(3);
  const {data4,loading4} = useGet(4);

  return <Card loading={loading1 || loading2 || loading3 || loading4}>
    <Children1 data={data1}>
    <Children2 data={data2}>
    <Children3 data={data3}>
    <Children4 data={data4}>
  </Card>
}
```
å¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº›æ•°æ®æœ¬æ¥åªåœ¨æŸäº›å•ç‹¬ç»„ä»¶ç‹¬ç«‹ä½¿ç”¨çš„ï¼Œä½†æ˜¯ç°åœ¨å´éœ€è¦åœ¨Appè¿›è¡Œå­ç»„ä»¶æ•°æ®çš„å¤„ç†ç„¶åä¼ é€’ï¼Œè¿™å¢åŠ äº†çˆ¶ç»„ä»¶çš„è´Ÿæ‹…ï¼Œè€Œä¸”å®é™…ä¸Šè€ƒè™‘æ›´å¤šä¸€äº›ï¼Œå­ç»„ä»¶å¯èƒ½ä¹Ÿéœ€è¦è¿›è¡Œå±‚å±‚ä¼ é€’ç»™æœ€ç»ˆçš„ç»„ä»¶ä½¿ç”¨ã€å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚Contextæ–¹æ¡ˆå‡å°‘ä¼ é€’ï¼Œä½†æ˜¯æ•°æ®è·å–ä¾æ—§æ˜¯åœ¨é¡¶å±‚è¿›è¡Œçš„ã€‘

ä½¿ç”¨`Suspense`å¯ä»¥å¾—åˆ°æ›´å¥½çš„ä½“éªŒï¼Œç°åœ¨çœ‹ä¸€ä¸‹ä½¿ç”¨`Suspense`çš„åšæ³•

### `Suspense`
```jsx
function App(){
  return <Suspense fallback={<Loader>}>
    <Children1>
    <Children2>
    <Wrap>
      <Wrap>
        <Children3>
      </Wrap>
    </Wrap>
</Suspense>
}
```

æ•°æ®çš„è·å–äº¤ç»™å­ç»„ä»¶å¤„ç†ï¼Œæ¯”å¦‚ï¼š
```js
const fetch3 = doFetch(3);
function Children3(){
  const data = cardFetch.read();
    return <div>
        è·å–ä¿¡æ¯ï¼š{data.info}
    </div>
}
```

ç°åœ¨æ•°æ®çš„è·å–äº¤ç»™å­ç»„ä»¶å¤„ç†ï¼Œ`Suspense`çš„å­å­™ç»„ä»¶ä¸­åªè¦æœ‰ä»»æ„ä¸€ä¸ªç»„ä»¶æŠ›å‡º`Promise`ï¼Œå°±æ˜¾ç¤º`Loader`ç»„ä»¶ã€‚

è¿™ç§åšæ³•çš„å¥½å¤„å°±åœ¨äºæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªä¸ªçš„å»å¤„ç†`loading`ï¼Œæˆ‘ä»¬å°†`loading`çš„æ•è·å’Œå¤„ç†äº¤ç»™`Suspense`ç»„ä»¶ï¼Œåœ¨`Chliren`å’Œ`App`ç»„ä»¶ä¸­åªå¤„ç†è‡ªå·±ç›¸å…³çš„æ•°æ®ã€‚

### `ErrorBoundary`
`ErrorBoundary`ç»„ä»¶å’Œ`Suspense`ç»„ä»¶å¾ˆåƒï¼Œ`Suspense`ç»„ä»¶æ˜¯å®˜æ–¹å®ç°çš„ï¼Œè€Œ`ErrorBoundary`ç»„ä»¶åˆ™éœ€è¦æˆ‘ä»¬å€ŸåŠ©`componentDidCatch`æˆ–è€…`static getDerivedStateFromError`å®ç°ã€‚

æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„`ErrorBoundary`
```js
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { error: null };
  }

  componentDidCatch(error, errorInfo) {
    this.setState({error})
  }

  render() {
    if(this.state.error) return this.state.error.message;
    return this.props.children; 
  }
}
```

ç”¨æ³•å’Œ`Suspense`ç±»ä¼¼
```js
function App(){
  return <ErrorBoundary>
    <Children1>
    <Children2>
    <Wrap>
      <Wrap>
        <Children3>
      </Wrap>
    </Wrap>
</Suspense>
}
```

### å…³äº`try-catch`
ä½¿ç”¨`try-catch`å¯¹äºé”™è¯¯å¤„ç†æœ‰ç€é‡è¦æ„ä¹‰ï¼Œçœ‹ä¸€ä¸‹ä¸ç”¨`try-catch`çš„å†™æ³•ï¼š
```js
function commit(data){
  if(data.name !== 'name' && data.some(x=>x.length === 0)) return message.error("æŠ¥é”™1") 
  //æ›´å¤šé”™è¯¯æ£€æŸ¥...

  fetchData();
}
```
ä¸ä½¿ç”¨`try-catch`åˆ™è¿«ä½¿æˆ‘ä»¬å¿…é¡»åœ¨`commit`ä¸­æ£€æŸ¥å’Œå¤„ç†é”™è¯¯ã€‚

å¦å¤–ï¼Œæˆ‘è¦è¯´ä¸€ä¸‹ï¼Œå½“é”™è¯¯è¾ƒä¸ºå¤æ‚æ—¶ï¼Œå¯èƒ½å°†é”™è¯¯æŠ½ç¦»æˆæ–¹æ³•ä»¥ä¾¿é˜…è¯»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹è¿™ä¸ªå‡½æ•°çš„åç§°å’Œè¿”å›å€¼æ˜¯é‡è¦çš„ï¼Œå› ä¸ºå…³ä¹æ˜¯å¦ä¸­æ–­æ‰§è¡Œã€‚

ç›®å‰æŠ½ç¦»çš„æ–¹æ³•ï¼Œå¹¶ä¸ç»Ÿä¸€ï¼Œæ¯”å¦‚è¯´ï¼š
```js
//æŠ½ç¦»çš„é”™è¯¯æ£€æŸ¥æ–¹æ³•
function check(){...}

function commit(){
  //å¯èƒ½checkä¸ºtrueï¼Œè¡¨ç¤ºæŸ¥åˆ°é”™è¯¯äº†
  if(check()) return ;

  //ä¹Ÿå¯èƒ½checkä¸ºtrueè¡¨ç¤ºæ£€æŸ¥é€šè¿‡ï¼Œæ²¡æœ‰é”™è¯¯ï¼Œå¯ä»¥æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚æ‰€ä»¥ä¸­æ–­éœ€è¦å–å
  if(!check()) return ;
}
```
äº‹å®ä¸Šï¼ŒåŒä¸€ä¸ªä¸Šä¸‹æ–‡å­˜åœ¨å¤šä¸ªé”™è¯¯æ£€æŸ¥ï¼Œå®ƒä»¬çš„`check`è§„åˆ™å¯èƒ½éƒ½ä¸ç»Ÿä¸€ï¼Œæ¯”å¦‚`check1`è¿”å›`true`æœ‰é”™ï¼Œè€Œ`check2`è¿”å›`true`æ˜¯é€šè¿‡ã€‚

ä¸åªæ˜¯æ¨ªå‘å¯èƒ½å­˜åœ¨å¤šä¸ªcheckï¼Œçºµå‘çš„è¿”å›å€¼æ›´åŠ éº»çƒ¦ï¼Œæ¯”å¦‚è¯´
```js
const check(){
  if(!childrenCheck()) return true;
  if(childrenCheck2()) return true;
  if(childrenCheck3()) return true;
  if(!childrenCheck4()) return true;
  return childrenChceck5();
}

function chechildrenCheckck5(){
  if(!leafCheck()) return true;
  if(leafCheck2()) return false;
  if(leafCheck3()) return true;
  if(!leafCheck4()) return false;
  return true;
}
```
å¸¦æ¥äº†ä¸¤ç‚¹è´Ÿé¢å½±å“ï¼š
1. æ›´å¤šçš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œéœ€è¦è€ƒè™‘è¿”å›å€¼
2. è¾ƒä¸ºåº•å±‚çš„é”™è¯¯ï¼Œä¹Ÿéœ€è¦åœ¨æ›´é«˜çš„å±‚çº§ä¸­å¤„ç†ã€‚è€Œè¿™ä¸­é—´ä¸€ç³»åˆ—çš„true\falseã€æ¨ªçºµæ–¹å‘éƒ½éœ€è¦è€ƒè™‘ã€‘ä¼šå¸¦æ¥æå¤§çš„è´Ÿæ‹…ã€‚

å¦‚æœä½¿ç”¨`try-catch`ä¼šçˆ½å¿«å¾ˆå¤šï¼Œä¸€æ—¦æœ‰é—®é¢˜ç›´æ¥`throw`é”™è¯¯ï¼Œè®©`catch`çš„éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œæ ¹æœ¬ä¸éœ€è¦è€ƒè™‘è¿”å›å€¼ä¼ é€’çš„é—®é¢˜ã€‚

# **ï¼å±é™©**ï¼šå†…å­˜å´©æºƒ

# `React.lazy`(ç»„ä»¶æ‡’åŠ è½½)
çœ‹äº†ä¸€ä¸‹ä½œç”¨ï¼Œç›®å‰æ²¡æ„Ÿè§‰ä½¿ç”¨çš„å¿…è¦ï¼Œå¾…æ·±å…¥â€¦â€¦

# å…¶ä»–
## åŸå§‹æ•°æ®åŠæ ¼å¼è½¬æ¢

# é‡æ„ï¼š`getGlobalConst`
ä¸ºä»€ä¹ˆéœ€è¦é‡æ„ï¼Ÿè¿™ä¸ªå‡½æ•°è´Ÿè´£çš„èŒè´£è¿‡å¤šäº†ï¼Œä½¿ç”¨çš„å¿ƒæ™ºè´Ÿæ‹…å¾ˆå¤§ï¼Œæ ¹æ®èŒè´£åˆ†æˆä¸åŒçš„å‡½æ•°æ›´æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹é‡æ„å‰çš„è°ƒç”¨ï¼š
```js
getGlobalConst(['k1','k2','k3'], true, true);
getGlobalConst(['k1','k2','k3'], true, false);
getGlobalConst(['k1','k2','k3'], false, true);
getGlobalConst(['k1','k2','k3'], false, false);
getGlobalConst(['k1','k2','k3'], false);
getGlobalConst(['k1','k2','k3'], true);
getGlobalConst(['k1','k2','k3']);
getGlobalConst();
```
æˆ‘è¯´ä¸‹ç¬¬ä¸€ä¸ªå‚æ•°çš„æ„ä¹‰ï¼Œæ ¹æ®ä¸åŒ`key`ä»æ•´ä¸ªç¼“å­˜æ•°æ®ä¸­æŒ‘é€‰é™¤æ‰€éœ€è¦çš„æ•°æ®ã€‚

ç›®å‰çš„ä½¿ç”¨è´Ÿæ‹…å¾ˆé‡ï¼ŒåŸå› åœ¨äºï¼š
1. ä¸‰ä¸ªå‚æ•°çš„å‡ºé”™çš„å¯èƒ½æ€§æé«˜ï¼Œå­˜åœ¨å‚æ•°å€¼é”™è¯¯ã€å‚æ•°é¡ºåºé”™ä¹±ã€å‚æ•°ç¼ºå¤±ç­‰æƒ…å†µï¼Œç»¼åˆæ¥è¯´ï¼Œè®°å¿†çš„è´Ÿæ‹…ä¹Ÿæ›´å¤§
2. é»˜è®¤å€¼å¸¦æ¥çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œè°ƒç”¨è€…ä¸æƒ³è®°ä½è¿™äº›é»˜è®¤å€¼ï¼Œè¶Šå¤šçš„é»˜è®¤å€¼è°ƒç”¨çš„é—¨æ§›è¶Šé«˜ï¼Œå‡ºé”™çš„å¯èƒ½æ€§ä¹Ÿè¶Šé«˜
3. èŒè´£æ··ä¹±ï¼šæ ‡è¯†å‚æ•°çš„å­˜åœ¨ï¼Œè¿™æ„å‘³è€…å†…éƒ¨å®ç°ä¹Ÿå¿…ç„¶å¾ˆç³Ÿç³•ã€å› ä¸ºè‚¯å®šæ‰¿æ‹…ç€å¾ˆå¤šèŒè´£ï¼Œè€Œåœ¨è¿™äº›ä¹‹å¤–è¿˜éœ€è¦æ‰¿æ‹…åŒºåˆ†æ ‡è¯†ç¬¦çš„èŒè´£ã€‘

å†çœ‹ä¸‹ä¿®æ”¹åçš„è°ƒç”¨ï¼š
```js
getGlobalConstSelectOpsArray(['k1','k2','k3'])
getGlobalConstSelectOpsObject(['k1','k2','k3'])
getNewestGlobalConstSelectOpsArray(['k1','k2','k3'])
getNewestGlobalConstSelectOpsObject(['k1','k2','k3'])
```
æˆ‘ä»¬æ€»ç»“ä¸‹é‡æ„åçš„è°ƒç”¨ä¼˜ç‚¹ï¼š
1. åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå‡ºé”™çš„å¯èƒ½æ€§å¤§å¤§é™ä½ï¼Œä½¿ç”¨æ—¶å¿ƒæ™ºè´Ÿæ‹…ä½
2. æ²¡æœ‰é»˜è®¤å€¼
3. èŒè´£çº¯ç²¹ï¼Œæ¯ä¸ªæ–¹æ³•åªè´Ÿè´£ä¸€ä»¶äº‹

æˆ‘çŸ¥é“ï¼Œæœ‰äººå¯èƒ½ä¼šè¿™ç§åšæ³•æå‡ºåå¯¹æ„è§ï¼Œæ¯”å¦‚è¯´ç°åœ¨å¯¹æ•°æ®çš„å˜åŒ–å­˜åœ¨2*2=4ï¼Œæ‰€ä»¥å¯ä»¥æ‹†è§£æˆ4ä¸ªæ–¹æ³•ï¼Œå¦‚æœæœ‰3ç§ã€4ç§ã€5ç§ï¼Œé‚£ä¹ˆå²‚ä¸æ˜¯è¦æ‹†8ã€16ã€32ç”šè‡³æ›´å¤šçš„æ–¹æ³•å‡ºæ¥ï¼Ÿ

å¹¶ä¸æ˜¯ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆå¹²ã€‚

å¦‚æœçœŸçš„å‡ºç°è¿™ç§åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°ç»„åˆæˆ–å…¶ä»–æ–¹æ¡ˆï¼Œæˆ‘ç¨å¾®ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´ç°åœ¨çœŸçš„å­˜åœ¨5ç§å˜åŒ–ï¼Œé‚£ä¹ˆå¯ä»¥è¿™ä¹ˆå†™ï¼š
```js
const foo1 = ()=>{}
const foo2 = ()=>{}
const foo3 = ()=>{}
const foo4 = ()=>{}
const foo5 = ()=>{}

//å¦‚æœå˜åŒ–åªå‡ºç°å°‘æ•°å‡ æ¬¡ï¼Œä½ å¯ä»¥ç›´æ¥ç»„åˆä½¿ç”¨
compose(foo1,foo2,foo3,foo4)(parmas)
compose(foo1,foo2,foo3)(params)
compose(foo2,foo4)(params)

//å¦‚æœè¿™äº›æ–¹æ³•ç»„åˆå‡ºç°äº†å¾ˆå¤šæ¬¡ï¼Œä½ åŒæ ·å¯ä»¥æŠ½è±¡æˆæ–°çš„å…¬å…±æ–¹æ³•
const f1 = compose(foo1,foo2)
const f2 = compose(foo1,foo3,foo4)
const f3 = compose(foo1,foo4,foo4)
const f4 = compose(foo1,foo5,foo2,foo2,foo4,foo3)
```
å¯ä»¥çœ‹åˆ°ï¼Œéå¸¸è‡ªç”±ï¼Œè€Œä¸”æ¯ä¸ªæ–¹æ³•éƒ½ç‹¬ç«‹å¯å¤ç”¨ï¼Œä¸ç»„åˆå•ç‹¬ä½¿ç”¨ä¹Ÿæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ç›¸åï¼Œå¦‚æœæ˜¯åŸæœ¬çš„å®ç°ï¼Œ5ç§å˜åŒ–æœ‰å¤šå°‘æ¡åˆ†æ”¯ï¼Ÿ32ç§ç”šè‡³æ›´å¤šã€‚è¦æ€ä¹ˆå¤„ç†ï¼Ÿ

è€Œä¸”ä½¿ç”¨æ ‡è¯†å‚æ•°çš„å†™æ³•éå¸¸ä¸é€‚åº”å˜åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»„åˆå¯ä»¥å¿«é€Ÿé€‚åº”æ–°éœ€æ±‚ï¼Œä¸ä¼šå½±å“åˆ°åŸæ¥çš„æ–¹æ³•ï¼Œè€Œæ ‡è¯†å‚æ•°çš„å†™æ³•åˆ™æ„å‘³ç€æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯åŒä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¯¹äºå…¶ä¸­ä»»ä½•ä¸€ç‚¹çš„ä¿®æ”¹å½±å“åˆ°çš„éƒ½æ˜¯å…¨å±€ï¼Œéš¾ä»¥é¢„æµ‹ä¿®æ”¹å¯¹å…¨éƒ¨è°ƒç”¨åœºæ™¯çš„å½±å“ã€‚

å¥½çš„å†™æ³•ï¼Œé¢å¯¹æ–°çš„éœ€æ±‚æˆ–å˜åŒ–æ˜¯æ‰©å±•ï¼Œä¸ä¼šå½±å“åˆ°åŸæ¥çš„åŠŸèƒ½ã€‚è€Œåçš„åšæ³•åˆ™æ˜¯é¢å¯¹æ–°çš„å˜åŒ–éƒ½éœ€è¦æ”¹å˜åŸæ¥çš„ä»£ç ï¼Œè¿™éå¸¸å±é™©ã€‚

## åŸä»£ç 
```js
const CACHE = {};
// globalconst
export async function getGlobalConst(options = [], useAPI = false, objectMode = false) {
  if (useAPI === true || CACHE.globalConst === undefined) {
    const res = await Api.get(`/comm/globalConst/all`)
    CACHE.globalConst = res.data;
  }
  const global = _.pick(CACHE.globalConst, options)
  if (_.size(global) !== _.size(options)) return console.log(_.size(global) !== _.size(options))
  if (objectMode) return _.reduce(global, (acc, item, k) => {
    acc[k] = _.map(item, ({ constDisplayName, interiorId, ...rest }) => ({ value: interiorId, text: constDisplayName, ...rest }))
    return acc
  }, {})
  return _.map(global, (item) => _.map(item, ({ constDisplayName, interiorId, ...rest }) => ({ value: interiorId, text: constDisplayName, ...rest })))
}
```

## é‡æ„
### æ ¸å¿ƒç±»`Cache`
```js
import { api as Api } from 'rootnet-core/base'
import { hasData } from 'rootnet-core/system'
import _ from 'lodash'

class Cache {
  constructor() {
    this._value = null
  }

  async getValue() {
    if (!hasData(this._value)) await this.update()
    return this._value
  }

  async getNewestValue() {
    await this.update()
    return this._value
  }
}

export class GlobalConstCache extends Cache {
  req = null

  async update() {
    if (GlobalConstCache.req) return GlobalConstCache.req
    GlobalConstCache.req = Api.get(`/comm/globalConst/all`)
      .then((res) => {
        this._value = res.data
        GlobalConstCache.req = null
      })
      .catch((error) => {
        console.error(`GlobalConstCacheè¯·æ±‚æŠ¥é”™ï¼š${error._message}`)
        GlobalConstCache.req = null
      })
    return GlobalConstCache.req
  }
}
```

### æä¾›çš„è°ƒç”¨æ–¹æ³•
```js
const GLOBAL_CONST_CACHE = new GlobalConstCache()

export async function getGlobalConstSelectOpsArray(options) {
  const globalData = await getPickGlobalConstData(options)
  return getAllSelectOptionArray(globalData)
}

export async function getGlobalConstSelectOpsObject(options) {
  const globalData = await getPickGlobalConstData(options)
  return getAllSelectOptionObject(globalData)
}

export async function getNewestGlobalConstSelectOpsArray(options) {
  await GLOBAL_CONST_CACHE.update()
  const globalData = await getPickGlobalConstData(options)
  return getAllSelectOptionArray(globalData)
}

export async function getNewestGlobalConstSelectOpsObject(options) {
  await GLOBAL_CONST_CACHE.update()
  const globalData = await getPickGlobalConstData(options)
  return getAllSelectOptionObject(globalData)
}
```

### æŠ½ç¦»çš„å·¥å…·æ–¹æ³•
```js
async function getPickGlobalConstData(options) {
  const data = await GLOBAL_CONST_CACHE.getValue()
  const globalData = pickGlobalData(data, options)
  checkDataSize(globalData, options)
  return globalData
}

function checkDataSize(globalData, options) {
  if (_.size(globalData) !== _.size(options)) throw new Error('è¿”å›æ•°æ®æ•°é‡åº”å½“ä¸è¯·æ±‚æ•°é‡ä¸€è‡´ï¼')
}

function pickGlobalData(data, options) {
  return _.pick(data, options)
}

function getAllSelectOptionArray(global) {
  return _.map(global, getSelectOption)
}

function getAllSelectOptionObject(global) {
  return _.reduce(
    global,
    (acc, item, k) => {
      acc[k] = getSelectOption(item)
      return acc
    },
    {}
  )
}

function getSelectOption(item) {
  return _.map(item, ({ constDisplayName, interiorId, ...rest }) => ({ value: interiorId, text: constDisplayName, ...rest }))
}
```
ç‰¹åˆ«è¯´ä¸€ä¸‹ï¼Œ`getSelectOption`çš„è§£æ„åšæ³•æ˜¯åçš„åšæ³•ï¼ŒåŸå› åœ¨äºï¼š
1. å¯èƒ½å‡ºç°å­—æ®µå†²çª
2. è§£æ„ä¼šåˆ›å»ºæ–°çš„æ•°æ®ï¼Œè¿™ç§åšæ³•ä¼šå¢åŠ å†…å­˜å¹¶ä¸”é™ä½æ£€ç´¢çš„æ•ˆç‡ã€‚å°¤å…¶è¿™é‡Œ`globalConst`çš„æ•°æ®é‡å¾ˆå¤§ï¼Œè¿™ç§åšæ³•ä½¿å¾—å æ®çš„å†…å­˜åˆå¤šäº†å¾ˆå¤šå€ï¼Œå¾ˆå±é™©ï¼Œæœ‰é¡µé¢å†…å­˜å´©æºƒçš„é£é™©
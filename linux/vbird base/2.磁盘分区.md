[TOC]

# 机械硬盘组成
- 碟片
- 机械手臂
- 磁头
- 主轴马达

## 分割单位
扇区(512B~4KB) => 磁道 => 碟面

# 分区格式
主要分为MBR和GPT两种

## MBR
MBR主要特点在于第一个扇区用于放置引导程序和分区表，扇区不小于512B，其中前446个字节用于放置引导程序，其后64个字节放置分区表

分区表用于记录分区，每个分区记录起始与结束分区序号，所以一共可以记录4个分区。

分区表记录的分区是主要分区和扩展分区，需要注意扩展分区最多有一个。

首先说一下为什么需要扩展分区，我们知道分区的最小单位是柱面（柱面必然是大于等于扇区，扇区是物理意义上的最小分区单位，不可能更小，但是根据实际使用需要，柱面可以大于分区，比如说扇区是512B，但是柱面可以是4K，16K这样）

然后我们知道根据柱面我们可以在分区表中进行划分，但是这样一来就有了一个限制，我们最多只能分4个区。

所以就有了扩展分区，扩展分区可以再进行分区，比如说限制有序号为1-400的磁盘，我们可以将1-100分为主要分区1，而101-400划分为扩展分区，然后在内部再次进行分区，这叫做**逻辑分区**，和MBR一样，扩展分区会划分一部分数据区记录分区表，这样扩展分区可以分出更多的区域。

现在考虑一个问题，为什么我们需要分区？
1. 安全，一旦其中某个分区出问题，处理不会影响到其他分区
2. 性能，划分之后查询效率更高

关于分区，我个人不喜欢使用主要分区，我自己的想法是更多的使用扩展分区，因为有一个好处，可以动态调整，比如说某个逻辑分区不够用或者太大，是可以调整的，而如果我们同时使用了主要分区和逻辑分区，则不能动态调整，动态调整的前提是分区是扩展分区。

实际上，可以认为分区就是对分区表做调整。

### MBR的缺陷
1. 引导程序区块太小，放不下较复杂的程序
2. 只有一个管理区块，一旦毁坏很难修复
3. 无法使用2.2T以上的磁盘容量

#### 为什么MBR无法使用2.2T以上的磁盘容量
这个问题一直困扰着我许久，因为刚刚说了一个分区表可以使用16个字节，我想的比较简单，8个字节记录起始扇区号，8个字节记录结束扇区号，1个字节是8bit，那么应该最大可以支持2^64*512B大小的空间，应该远超2.2T才对。

实际上并不是这样，我查阅资料之后发现分区表记录的信息很多，留给记录起始和结束扇区号只有4字节，这样最大可以支持2^32*512B的空间，约等于2T

> 注：512B为默认标准扇区大小

MBR分区表详细结构：

![MBR分区表详细结构](https://img-blog.csdnimg.cn/img_convert/35c28f3db7d3565ae1d7d1280da94b30.gif)

## GPT
划分单位是LBA，以前默认扇区大小是512B，但是随着时代发展，扇区大小有了变化，处理512B大小的扇区，还有4k扇区存在，所以为了标准化，LBA的区块大小就是512B，忽略物理扇区的规格不同。

GPT共使用了68个LBA进行分区管理，其中34个扇区是备份。

LBA0是引导程序扇区，同样前446字节是放置引导程序，而原分区表区块只放置标识符，用于标识是GPT格式。

LBA1是管理分区表的数据区，LBA2-LBA33是实际分区表记录区别，LBA1是记录分区表区块位置和大小的区块，同时也记录了对应备份区块的位置以及校验码，如果校验码不匹配，则会使用备份区块对分区表进行恢复。

LBA2-LBA33区块，用于记录分区的区块，每个LBA记录4组分区数据，512/4=128，即1组分区数据可以使用128字节记录，相比MBR的16字节有了巨大提升，在GPT中分包分配了8字节的大小用于记录扇区起始和结束位置，所以实际可以支持2^64*512B空间，约等于2^30TB容量，差不多10亿TB这样。

另外值得一提的是，在GPT分区中不分主要分区、扩展分区、逻辑分区，所有分区都是主要分区

# 启动程序
- BIOS
- UEFI

## BIOS
基本输入输出系统，使用汇编编写，BIOS会读取指定地址的指令，就是磁盘引导扇区代码。

其代码主要目的就是供用户选择合适的内核代码，因为实际上一个磁盘是可以安装多个内核的，可以有多重引导。

默认主引导扇区有引导代码，然而实际上每个分区都有自己的引导扇区，引导扇区可以指向对应的内核，所以一份磁盘中可以有多份操作系统，引导扇区代码可以让我们选择其中一份进行启动。

## UEFI
相比于BIOS，更安全、启动速度更快、更容易移植、开发更简单。

具体细节暂略

# 目录树
Linux相比Windows分区特殊的地方在于，Windows是通过盘符进行分区的，而Linux则是将磁盘**挂载**到对应目录下，所有文件及目录都源于根目录`/`从而组成一个目录树

# 名词
- MBR：Master Boot Record 
- GPT：GUID Partition Table
- LBA：Logical Block Address

# 参考资料
- [MBR分区表为什么最大只能识别2TB硬盘容量](https://blog.csdn.net/liuxiao723846/article/details/120013643)

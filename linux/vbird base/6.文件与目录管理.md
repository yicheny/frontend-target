[TOC]

# 相对路径与绝对路径
- 绝对路径：从根目录写起
- 相对路径：从当前目录写起

# 目录操作
几种特殊目录
- `.` 当前目录
- `..` 上一层目录
- `-` 前一个工作目录
- `~` 当前用户家目录
- `~account` 指定用户家目录【例如`~abc`，指代用户abc的家目录】

## `cd`
切换目录

## `pwd`
显示当前目录
- `-P` 显示真实文件路径，而非链接文件路径

## `mkdir`
创建新目录
- `-m` 设置权限，不使用默认权限
- `-p` 可以递归创建

```shell
mkdir -p /t1/t2/t3/t4
```

## `rmdir`
删除空目录
- `-p` 递归删除上层空目录

# 执行文件路径变量：$PATH
> 变量在第10章学习BASH时会进行说明

关于命令，大致可以分为两类，一类是内置的BASH命令，一类是外部安装的指令，比如说`ls`，实际上是`/bin/ls`文件

那么有一个问题？为什么我们执行`ls`会直接执行`/bin/ls`文件？

这就涉及到`$PATH`变量，Shell程序会优先查找内部指令，如果找不到会查找外部安装的指令，所以我们无论在哪个目录下都可以执行`ls`这一类指令

这个外部安装的指令就是通过`$PATH`配置的

通过`echo $PATH`可以看到当前配置的命令

# 文件及目录管理
## `ls`
查看文件
- `-a` 查看全部文件，包括隐藏文件（以`.`开头的文件）
- `-A` 查看全部文件，包括隐藏文件，但是不含`.`、`..`目录
- `-d` 仅列出目录本身，而不是列出目录内的文件数据
- `-f` 直接列出结果，不进行排序（ls默认会使用名称排序）
- `-F` //根据文件、目录等类型，添加额外的数据信息
- `-h` 文件大小只展示最高容量及其单位进行展示（更易读）
- `-i` 列出`inode`号码
- `-l` 详细信息，包括文件属性、权限等
- `-n` 列出UID和GID
- `-r` 逆序列出
- `-R` 连子目录一起列出
- `-S` 按文件大小列出
- `-t` 按时间排序
- `--time=[atime,ctime]` 默认是`mtime`

## `cp`
```shell
cp [options] 源文件 目标文件
```

复制文件
- `-a` 相当于`-dr --preserve=all`
- `-d` 若源文件为链接文件，则复制链接文件
- `-f` 强制复制
- `-i` 若目标文件已存在，则覆盖前会先询问
- `-l` 创建硬链接
- `-p` 连文件属性（权限、用户、时间）一起复制，而不是使用默认属性
- `-r` 递归复制，用于目录复制
- `-s` 创建快捷方式（symbolic link）
- `-u` 目标文件不存在，或目标文件比源文件旧的情况下才进行复制
- `--preserve=all` 除`-p`的属性外，还包含`SELinux`的属性，可以认为是对文件属性更全面的复制

> 注1：源文件有2个以上时，则目标文件必须是目录
 
> 注2：复制所有属性也没法复制ctime

## `rm`
删除文件
- `-f` 强制删除，忽略不存在的文件，不会出现警告
- `-i` 删除前会询问使用者
- `-r` 递归删除

## `mv`
移动文件
- `-f` 强制移动（有目标文件则强制覆盖）
- `-i` 存在目标文件时，覆盖前会进行询问
- `-u` 若目标文件已经存在，且源文件更新时，才进行更新

## `basename`
```shell
basename /etc/sysconfig/network 
=> network
```

## `dirname`
```shell
dirname /etc/sysconfig/network
=> /etc/sysconfig
```

# 查看文件内容
- `cat` 正序查看
- `tac` 倒序查看（以行为单位）
- `nl` 相当于`cat`，但是会标注行号
- `more` 一页一页的查看内容
- `less` 和`more`类似，但是可以向前翻页
- `head` 看开始的几行
- `tail` 看结尾的几行
- `od` 以二进制方式读取

## `cat`
- `-A` 相当于`-vET`
- `-b` 针对非空白行列出行号
- `-E` 显示结尾换行符
- `-n` 列出行号，包括空白行
- `-T` 将`Tab`键以`^I`显示
- `-v` 显示特殊字符

## `tac`
略

## `nl`
略

## `more`
- `Space` 下一页
- `Enter` 下一行
- `/字符串` 向下查找指定字符串
- `:f` 显示文件名以及目前的行数
- `q` 离开
- `b` 往回翻页（对文件有效，对管道无效）

## `less`
- `Space` 下一页
- `Enter` 下一行
- `PageDown` 下一页
- `PageUp` 上一页
- `/字符串` 向下查找
- `?字符串` 向上查找
- `n` 重复上一次查找
- `N` 反向重复上一次查找
- `g` 跳到第一行
- `G` 跳到最后一行
- `q` 离开

## `head`
- `-n` 截取前`n`行进行展示，默认10行

## `tail`
- `n` 截取后`n`行进行展示，默认10行

## `od`
- `t` 以不同类型进行展示
  - `a` 使用默认字符进行输出
  - `c` 使用`ASCII`进行输出
  - `d[size]` 十进制输出，每个字符占用size bytes
  - `f[size]` 浮点数输出，每个字符占用size bytes
  - `o[size]` 八进制输出，每个字符占用size bytes
  - `x[size]` 十六进制输出，每个字符占用size bytes

示例：
```shell
od dpu8.txt -t x2
```

# `touch`
- 创建新文件
- 修改文件时间
  
关于文件时间
- 读取时间(access time，atime) 每次文件被读取时更新
- 状态时间(status time，ctime) 当文件的状态被改变时更新，比如权限或文件属性修改
- 修改时间(modification time,mtime) 当文件的“内容”被改变时更新

参数
- `-a` 修改atime，默认此刻
- `-c` 仅修改时间，若文件不存在不会创建新文件
- `-d` 自定义时间，使用字符串【？】
- `-m` 修改mtime，默认此刻
- `-t` 自定义时间，格式`YYYYMMDDHHMM.ss`
- `-r` 将源对象时间统一设为目标对象时间 

# `file`
查看文件类型及信息

# 权限
我们创建或复制文件时，如果没有显式赋于权限，则会使用默认权限。

默认权限是多少？使用`umask`即可查看

示例：
```shell
umask
=> 0022
```
这里四个数字分别代表：
- 特殊权限
  - SUID 4
  - SGID 2 
  - Sticky bit 1
- Owner 
- Group
- Other

我们关注后面三个权限，这里是rwx的权限设置。

另外需要注意的是，这里是掩码，即使用`7-x`得到的才是文件权限。

比如说默认创建文件的权限实际上是`777 - 022 = 755`

另外需要注意的是，文件的最大权限是666,目录最大权限是777，所以对应`022`的`mask`，文件默认权限为`644`，目录默认权限是`755`

参数
- `-S` 以符号形式展示权限

使用`umask 权限`可以修改默认权限

# 隐藏属性
注意：chattr 命令只在ext2、ext3、ext4的文件系统上生效，xfs支持部分文件参数

## chattr
配置隐藏属性
- `+` 增加属性
- `-` 删除属性
- `=` 重设属性
- `A` 设置后`atime`禁止修改
- `S` 修改时会同步到磁盘（文件一般是非同步写入）
- `a` 文件只能增加内容，不能删除和修改内容，此属性只能root设置
- `c` 存储时先压缩在存储，读取时先解压再读取
- `d` 当dump程序执行时，此文件不会被dump备份
- `i` 不能被删除、该民、设置链接、禁止写入和新增数据，仅root可以设置
- `s` 被删除时完全从磁盘删除，不能恢复
- `u` 被删除时保留在磁盘中，可以恢复

## lsattr
查看隐藏属性
- `-a` 显示全部属性
- `-d` 如果是目录，则只列出目录本身属性（默认会将目录内文件进行展示）
- `-R` 连同子目录数据一起展示

# 特殊权限
## Set UID 
```shell
ls -l /usr/bin/passwd
=> - rwsr-xr-x. 1 root root 27856 4月 1 2020 /usr/bin/passwd
```
注意权限，这里出现的`s`就是`SUID`【仅当`s`出现在Owner位置时】

这里解释下`SUID`权限，举一个例子，这里我们有一个文件`/etc/shadow`，里面存储了所有账号的密码，这个文件的权限是`----------`，除了`root`其他任何角色都不能读写。

那现在就有一个问题，既然这个文件只有`root`可以读写，那么一般用户可以修改密码吗？

当然可以，通过`passwd`命令，为什么`passwd`命令可以修改`/etc/shadow`文件的内容，关键就在于`SUID`，`SUID`赋予了命令执行时拥有`root`权限，所以可以对其他文件进行操作。

而相对应的，没有设置`SUID`权限的命令，比如`cat`就不能对`/etc/shadow`这一类文件进行读取。

现在具体说一下`SUID`的功能
1. 设置文件必须是可执行的二进制文件（`Shell`脚本文件不能设置） 
2. 文件等同于具备`x`权限，可执行
3. 执行程序仅在执行中具有`root`权限

设置SUID，设置权限时加上特殊权限权重即可（GUID、SBIT同理）
```shell
# 这个首位权限就是特殊权限设置，4-SUID、2-GUID、1-BIT，可叠加
chmod 4755 test  
```

## Set GID
```shell
ls -l /usr/bin/locate
=> - rwx--s--x. 1 root slocate 40520 4月 11 2018 /usr/bin/locate
```

```shell
ll /var/lib/mlocate/mlocate.db
=> -rw-r-----. 1 root slocate 3048118 5月  18 05:24 /var/lib/mlocate/mlocate.db
```

和上面类似，如果不是这个用户组的用户是不能进行读取的，但是如果执行程序赋予了`GUID`权限，则在执行时会得到有效用户组的支持，从而可以得到用户组权限。

## Sticky Bit
```shell
mkdir ./t1
chmod 1777 t1
ll 
=> drwxrwxrwt. 2 root root        6 5月  18 12:47 t1
```
注意这个`t`，`t`就是`SBIT`的标识

仅针对目录有效
1. 当用户对目录拥有wx权限
2. 在此目录下建立的文件或目录，仅有自己与root才可以删除

# 查找命令或文件
## `which`
用于查找执行文件的位置

> 此命令是根据`$PATH`这个环境变量所设置的路径进行查找的

```shell
which [-a] command
```
- `-a` 将所有找到的位置展示【默认只展示第1个】

## `whereis`
在指定目录下查找文件

```shell
whereis [-lbmsu] 文件或目录名
```
- `-l` 列出用于查询的目录
- `-b` 只查询binary【二进制】文件
- `-m` 只找在`manual`目录下的文件
- `-s` 只找source源文件
- `-u` 查找不在以上三个类型中的其他文件

## `locate`
在数据库中，而不是在磁盘中查找

```shell
locate [-iclSr] keyword
```
- `-i` 忽略大小写
- `-c` 不输出文件名，仅列出找到的文件数量
- `-l` 输出的行数
- `-S` 输出locate所使用的数据库文件的相关信息
- `-r` 支持正则表达式写法

### `updatedb`
`locate`查询速度非常快，不过也有缺陷，因为它是从数据库读取数据，所以可能不同步。

使用`updatedb`命令会更新数据库数据

## `find`
```shell
find [PATH] [option] [action]
```

1. 时间相关的参数（注：时间可以使用`atime`、`ctime`、`mtime`，这里以`mtime`进行说明）
- `-mtime n` n天前【一天以内】被修改过的文件
- `-mtime +n` n天前【不含n】被修改过的文件
- `-mtime -n` n天内【含n】被修改的文件
- `-newer file` 找出比`file`更新的文件

范例
```shell
find /etc -mtime 0 #从现在开始到24小时前的文件
find /etc -mtime +4 #大于等于5天前的文件 
find /etc -mtime -4 #小于等于4天内的文件 
find /etc -mtime 4 #4-5那一天的文件
```

2. 使用者或用户组相关的参数
> 根据指定信息，查找出相关用户或用户组的文件
- `-uid n` 使用者id，即`uid`
- `-gid n` 用户组id，即`gid`
- `-user name` 用户名称
- `-group name` 用户组名称
- `-nouser` 查找文件拥有者不在`/etc/passwd`内
- `-nogroup` 查找文件的拥有用户组不在`/etc/group`内

范例
```shell
find /home -user a # 查找用户a的所有文件
find / -nouser # 查找不属于任何人的文件
```

3. 文件权限及名称有关的参数
- `-name filename` 查找文件名为`filename`的文件，关键字可以使用`"*keyworld*"`
- `-size [+-]size` 查找大于（+）或小于（<）指定尺寸的文件（可以带单位，默认单位Bytes）
- `-type TYPE` 查找只当类型的文件，类型有
  - `f` 一般文件
  - `b,c` 设备文件
  - `d` 目录文件
  - `l` 链接文件
  - `s` 套接字文件
  - `p` 管道文件
- `-perm mode` 查找恰好等于的文件权限
- `-perm -mode` 查找全部包含的权限（比如755包含744）
- `-perm /mode` 查找包含任一权限的文件（比如/755，则600也会被查出来）
 
范例
```shell
find /run -size +60k #查找大于60KB的文件 
```

4. 额外可进行的操作
- `-exce command` 可执行其他命令来处理查找到的结果
- `-print` 将结果打印到屏幕上，这是默认操作

范例：
```shell
find /root/下载 -name "*welcome*" -exec ls -l {} \;
```
注意，查找到的结果会被放到`{}`内然后执行

# 资料
- [touch 命令](https://www.cnblogs.com/peida/archive/2012/10/30/2745714.html)
- [linux特殊权限SUID、SGID、SBIT](https://www.jianshu.com/p/e6c4c4bdf7c3)

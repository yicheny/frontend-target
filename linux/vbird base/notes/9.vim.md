[TOC]

# vi
## 三种模式
- 一般命令模式（command mode），简称一般模式，默认打开文件就是一般模式，可以移动光标、复制、粘贴、删除等
- 编辑模式（insert mode）
  - 按下【i、o、a、r】中的任意一个都会进入编辑模式
  - 按下`ESC`键，退出编辑模式
- 命令行模式（command-line mode）
  - 输入【:/?】中的任何一个，此时光标会移到最后一行，可以输入命令并按下回车执行，比如`:wq`

## 常见操作流程
- `vi 文件名` 打开文件，默认一般模式
- 按下i,o,a,r中的任意一个，进入编辑模式
- 按下`ESC`退出编辑模式
- 输入`:wq`并回车，保存并退出

## 按键说明
### 一般命令模式
#### 移动光标相关1

| 按键 | 作用 | 
| --- | --- |
| h、⬅ | 光标向左移动一个字符 |
| j、⬇ | 光标向下移动一个字符 |
| k、⬆ | 光标向上移动一个字符 |
| l、➡ | 光标向右移动一个字符 |

> 如果想要快速移动，比如想要向下移动，可以先按下30，然后按`j`或`⬇`即可


#### 移动光标相关2

| 按键 | 作用 | 
| --- | --- |
| Ctrl + f | 屏幕向下移动一页，相当于`Page Down` |
| Ctrl + b | 屏幕向上移动一页，相当于`Page Up` |
| Ctrl + d | 屏幕向下移动半页 |
| Ctrl + u | 屏幕向上移动半页 |
| + | 光标移动到非空格的下一行 |
| - | 光标移动到非空格的上一行 |
| n + Space | n表示数字，输入数字n后再按空格键，光标会向右移动n个字符 |
| 0、Home | 移动到这一行最前面的字符处 | 
| $、End | 移动到这一行的末尾字符处 |
| H | 光标移动到这个屏幕的最上方的那一行的第一个字符 |
| M | 光标移动到这个屏幕的中央的那一行的第一个字符 |
| L | 光标移动到这个屏幕的最下方的那一行的第一个字符 | 
| G | 移动到这个文件的最后一行 | 
| n + G | n为数字，移动到这个文件的第n行 |
| g + g | 移动到这个文件的第一行，相当于`1 + G` | 
| n + Enter | n为数字，光标向下移动n行 |


#### 查找与替换

| 按键 | 作用 |
| --- | --- |
| /word | 向光标之下的内容查找指定字符串 | 
| ?word | 向光标之上的内容查找指定字符串 | 
| n | 重复前一个查找 | 
| N | 反向重复前一个查找，比如上一次是向上查找，执行此命令后会执行向下查找 | 
| :n1,n2s/word1/word2/g | 在第n1行到n2行之间寻找特定字符串【word1】并将其替换为指定字符串【word2】。举例，想要在第100行到200行之间查找`abc`并将其替换为`ABC`，则：`:100,200/abc/ABC/g` |
| :1,$s/word1/word2/g | 在第1行到最后一行之间进行查找并替换 | 
| :1,$s/word1/word2/gc | 加上c替换前会进行确认 |

#### 删除、复制与粘贴

| 按键 | 作用 |
| --- | --- |
| x | 向后删除一个字符，相当于`del` | 
| X | 向前删除一个字符，相当于`BackSpace` | 
| nx | n为数字，连续向后删除x个字符 | 
| dd | 剪切光标所在的那一整行 | 
| ndd | n为数字，剪切光标所在的向下n行 | 
| d1G | 剪切光标所在处，到第1行的所有数据 | 
| dG | 剪切光标所在处，到最后1行的所有数据 | 
| d$ | 剪切光标所在处，到该行的最后一个字符 | 
| d0 | 剪切光标所在处，到该行的最前面一个字符 | 
| yy | 复制光标所在行 | 
| nyy | n为数字，复制光标所在向下n行 | 
| y1G | 复制光标所在行到第1行的所有数据 | 
| yG | 复制光标所在行到最后1行的所有数据 | 
| y$ | 复制光标所在处，到该行的最后一个字符 | 
| y0 | 复制光标所在处，到该行的最前面一个字符 | 
| p | 将已复制的内容在光标下一行粘贴 | 
| P | 将已复制的内容在光标上一行粘贴 | 
| J | 将光标所在行与下一行数据合成同一行 | 
| ncj | 向下删除n行数据 |
| u | 恢复前一个操作 | 
| Ctrl + r | 重做上一个操作 | 
| . | 重复前一个操作 |

### 一般命令模式 => 编辑模式

| 按键 | 作用 |
| --- | --- |
| i | 插入模式，从当前光标所在处插入 | 
| I | 插入模式，从当前所在行的第一个非空字符处开始插入 | 
| a | 插入模式，从光标所在的下一个字符串处开始插入 | 
| A | 插入模式，从光标所在行的最后一个字符串处开始插入 | 
| o | 插入模式，在光标所在行的下一行处插入新的一行 |
| O | 插入模式，在光标所在行的上一行处插入新的一行 | 
| r | 替换模式，替换光标所在的那一个字符一次 | 
| R | 替换模式，一直替换光标所在的文字，直到按下`ESC`为止 | 
| Esc | 退出编辑模式，返回一般命令模式 |  

### 一般命令模式 => 命令行模式

| 按键 | 作用 |
| --- | --- |
| :w | 将编辑的数据写入到硬盘文件中 |
| :w! | 当文件属性为“只读”时，强制写入文件，具体能否写入取决于权限 |
| :q | 退出 | 
| :q! | 不保存退出 | 
| :wq | 保存后退出 | 
| :wq! | 强制保存后退出 | 
| ZZ | 若文件没有修改，则直接退出，若文件被修改，则保存后退出 | 
| :w filename | 将编辑的数保存成另一个文件 | 
| :r filename | 在编辑的数据中，读入另一个文档的数据，将指定文件的内容追加到光标所在行后面 | 
| :n1,n2 w filename | 将n1到n2行之间的内容保存为另一个文件 | 
| :! command | 暂时退出vi到命令行模式下执行command的显示结果。例如【:! ls /home】即可在vi当中查看/home下面以ls输出的文件信息 | 
| :set nu | 显示行号，设置之后，会在每一行的前缀显示改行的行号 | 
| :set nonu | 取消行号 | 

## 缓存及恢复
有人可能会有一种担心：如果我编辑的时候，断电或者程序崩溃了，内容没来得及保存，岂不是非常危险？

其实并不是，vim有缓存机制，在编辑中的内容会保存为一个`.filename.swp`文件，如果正常结束程序，那么这个缓存文件会被删除，反之，如果程序是以非自然手段结束的，那么缓存文件就被保留下来。

所以，即使程序是以非自然手段结束，也可以恢复数据。

```shell
E325: 注意
发现交换文件 ".host.txt.swp"
            所有者: root    日期: Wed May 25 05:02:19 2022
            文件名: ~root/tmp/viTest/host.txt
            修改过: 是
            用户名: root      主机名: localhost.localdomain
           进程 ID: 84276 (仍在运行)
正在打开文件 "host.txt"

(1) Another program may be editing the same file.  If this is the case,
    be careful not to end up with two different instances of the same
    file when making changes.  Quit, or continue with caution.
(2) An edit session for this file crashed.
    如果是这样，请用 ":recover" 或 "vim -r host.txt"
    恢复修改的内容 (请见 ":help recovery")。
    如果你已经进行了恢复，请删除交换文件 ".host.txt.swp"
    以避免再看到此消息。

交换文件 ".host.txt.swp" 已存在！
以只读方式打开([O]), 直接编辑((E)), 恢复((R)), 退出((Q)), 中止((A)):
```
- `[O]pen Read-Only`：以只读模式打开源文件
- `(E)dit anyway`：编辑模式打开源文件
- `(R)ecover`：使用缓存文件替换源文件并打开
- `(D)elete it`：删除缓存文件并打开源文件
- `(Q)uit`：按下`q`，离开当前编辑的文件
- `(A)bort`：终止当前编辑，离开`vim`程序

# vim
## 可视区
| 按键 | 作用 |
| --- | --- |
| v	| 字元选择，会将游标经过的地方反白选择！ |
| V	| 列选择，会将游标经过的列反白选择！ |
| Ctrl + v | 区块选择，可以用长方形的方式选择资料 |
| y	| 将反白的地方复制起来 |
| d	| 将反白的地方删除掉 |
| p	| 将刚刚复制的区块，在游标所在处贴上！ |

## 多文件编辑
```shell
vim file1 file2 ……
```

| 按键 | 作用 |
| --- | --- |
| :n | 编辑下一个档案 |
| :N | 编辑上一个档案 |
| :files | 列出目前这个vim 的开启的所有档案 |

## 多视窗编辑
多文件编辑是同时编辑多个文件，但是页面中只有一个文件的内容。

而多视窗，则是在一个页面中，打开多个视窗，可以同时编辑和查看多个文件。

多视窗主要有两种场景：
1. 涉及多个文件的内容相互有所关联
2. 同一个文件的内容不同区域有所关联

### 开启多视窗
前提是使用`vim`先打开一个文件，然后:
```shell
:sp [filename]
```
如果不加文件名，则是以当前文件开启新视窗，加上文件名，则会以指定文件开启新视窗

### 相关指令

| 按键 | 作用 |
| --- | --- |
| :sp [filename] | 开启一个新视窗，如果有加filename， 表示在新视窗开启一个新档案，否则表示两个视窗为同一个档案内容(同步显示)。  |
| [ctrl] + w + j/↓ | 游标移动到下方的视窗。|
| [ctrl] + w + k/↑	| 游标移动到上面的视窗。|
| [ctrl] + w + w | 游标移动到上面的视窗。（可循环切换）|
| :q | 结束当前视窗 |

## 字词补全
前提：
1. 进入vim的编辑模式
2. `Ctrl + x`进入补全模式

```shell
-- ^X 模式 (^]^D^E^F^I^K^L^N^O^Ps^U^V^Y)
```
> 注意^表示`Ctrl`

常用的补全模式：
- `Ctrl + N` 使用文档内的单词进行补全
- `Ctrl + O` 使用文档后缀名（`.js`，`.css`）其内置支持的语法词进行补全

## 环境设定
> 通过`:set all`可以查看所有环境设定

| 按键 | 作用 |
| --- | --- |
| :set nu | 设置行号 |
| :set nonu | 取消行号 |
| :set hlSearch | 设置高亮查询（默认） |
| :set nohlsearch | - |
| :set autoindent | 设定自动缩排 |
| :set noautoindent | - |
| :set backup | 是否设置备份档。设置后会在当前目录下保存名为`filename~`的文件 |
| :set nobackup | - |
| :set ruler | 显示在右下角的列状态信息 | 
| :set noruler | - |
| :set showmode | 显示`--INSERT--`等信息在左下角的状态列|
| :set backspace=(012) | `Backspace`键允许删除的字元，设定为2时（默认）可删除任意字元；设定为0或1时，只能删除新输入的字元，不能删除原有的字元 |
| :set | 显示与系统预设值不同的设定参数， 一般来说就是我们自行变动过的设定 |	
| :syntax on | 依据程式相关语法显示不同颜色？|
| :syntax off | - |
| :set bg=dark、light | 显示指定的颜色色调 |

整体vim的环境设定在`/etc/vimrc`文件中，推荐做法时修改`~/vimrc`文件，默认不存在，可以创建并编辑：
```
这个档案的双引号(") 是注解
set hlsearch "高亮度反白
set backspace=2 "可随时用倒退键删除
set autoindent "自动缩排
set ruler "可显示最后一列的状态
set showmode "左下角那一列的状态
set nu "可以在每一列的最前面显示行号啦！
set bg=dark "显示不同的底色色调
syntax on "进行语法检验，颜色显示。
```

> vim操作相关的信息在~/.viminfo，比如上一次游标停在哪一行，上一次的高亮文字状态

## 常用命令图

## 使用注意事项
### 中文编码

### DOS 与Linux 的断行字元

### 语系编码转换

# 相关资料
- [vim打开交换文件(swp)时Quit和Abort的区别](https://www.cnblogs.com/a3192048/p/12241244.html)

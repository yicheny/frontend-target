[TOC]

# 系统的硬件组成
## 总线
1. 贯穿整个系统的一组电子管道，称作总线
2. 携带信息字节并负责在各个部件间传递
3. 通常总线被涉及成传送定长的字节块，就是**字**
4. 字长是一个基本系统参数，各个系统不尽相同，现在机器大多时4字节（32位）或8字节（64位）

## I/O设备
1. 每个I/O设备通过一个控制器或适配器与I/O总线相连
2. 控制器和适配器之间的区别在于它们的封装方式
    1. 控制器是I/O设备本身或者系统的主印刷电路板（通常主板）上的芯片组
    2. 适配器是插在主板上的卡
3. 控制器和适配功能是相同的：在I/O设备和I/O总线间传递信息

## 主存
1. 主存是一个**临时**存储设备，在处理器执行程序时，用来存放程序和程序处理的数据
2. 从物理上来说，主存是一组动态随机存取存储器（DRAM）芯片组成的
3. 从逻辑上来说，存储器是一个线性的字节数组
    1. 每个字节自己都有其唯一的地址（数组索引）
    2. 这些地址是从0开始的

## 处理器
1. 中央处理单元（CPU），简称处理器
2. 是解释或执行存储在主存中指令的引擎
3. 处理器核心是一个大小为1个字的存储设备（寄存器），也被叫做程序计数器（PC）
    1. 在任何时刻，PC都指向主存中某条机器语言指令（即含有该条指令的地址）

指令可能要求CPU执行以下操作：
1. 加载：从主存加载一个字节或一个字到寄存器
2. 存储：从寄存器赋值一个字节或一个字到主存的某个位置
3. 操作（运算）：把两个寄存器的内容复制到`ALU`，`ALU`对这两个字做算术运算，并将结果存放到一个寄存器中
4. 跳转：从指令本身抽取一个字，将这个字复制到程序计数器上

# 操作系统管理硬件
基本功能：
1. 防止硬件被失控的应用程序滥用
2. 向应用程序提供简单一致的机制来控制复杂、而又大不相同的低级硬件设备

操作系统通过几个基本的抽象概念实现功能：文件、虚拟内存、进程

## 文件
对I/O设备的抽象表示

## 虚拟内存
对主存和磁盘I/O设备的抽象表示

## 进程
对处理器、主存和I/O设备的抽象表示

1. **进程**是操作系统对一个正在运行的程序的一种抽象
2. **并发运行**指一个进程和指令和另一个进程的指令是交错执行的
3. **上下文切换**指操作系统实现这种交错执行的机制

操作系统保持跟踪进程运行需要的所有状态信息，就是**上下文**

内核
1. 进程之间的切换是操作系统内核管理的
2. 内核是操作系统代码常驻的主存的部分
3. 当应用程序需要操作系统的某些操作时，比如说读写文件，它就执行一条特殊的系统调用指令，将控制权传递给内核，然后内核执行被请求的操作并返回应用程序
4. 内核不是一个进程，它是系统管理全部进程所用代码和数据结构的集合

## 线程
1. 现代系统中，一个进程可以由多个称为**线程**的执行单元组成
2. 每个线程都运行在进程的上下文中，并共享同样的代码和全局数据

## 文件
1. 文件就是字节序列
2. I/O设备（包括磁盘、键盘、显示器、网络）都可以看成文件
3. 文件为应用程序提供了统一的视图

# 重要主题
## 并发`concurrency`
指一个同时具有 多个活动 的系统

## 并行`parallelism`
用并发来使用系统运行的更快

### 线程级并行
1. 线程构建在进程这个抽象之上，我们可以在一个进程中执行多个控制流
2. 20世纪60年代初期出现**时间共享**以来，系统就开始有了并发的支持
    1. 传统意义上，这种并发是模拟的，是通过一台计算机在它执行的进程间快速切换实现的
    2. 此时已经允许多个用户和系统进行交互
    3. 也允许一个用户同时进行多个任务
    4. 实际上，计算还是由一个处理器完成的，这种配置称为**单处理器系统**
    5. 构建一个由 单操作系统内核控制的多处理器 组成的系统时，我们就得到了一个**多处理器系统**
4. 20世纪80年代开始，在大规模的计算中就有了多处理器系统，但是直到多核处理器和超线程的出现，这种系统才变得常见

超线程
1. **超线程**，有时称为**同时多线程**，是一项允许一个CPU执行多个控制流的技术
2. 它涉及CPU某些硬件有多个备份，比如程序计数器和寄存器文件，
3. 而其他硬件部分只有一份，比如执行浮点算术运算的单元
4. 常规的处理器需要约20000个时钟周期做不同线程间的切换，而超线程处理器可以在单个周期的基础上决定要执行哪一个线程，这使得CPU能够更好的利用他的处理资源
    - 假设一个线程必须等到某些数据被装载到高速缓存上，此时CPU可以执行另一个线程
    - 举例，`Intel Core i7`处理器可以让每个核执行两个线程，所以一个4核系统可以并行的执行8个线程

多处理器
1. 多处理器的使用可以从两个方面提高系统性能
2. 首先，它减少了执行多个任务时模拟并发的需要【多处理器可以真正的进行并发，如果任务量不大，那么就不需要“模拟”并发】
3. 其次，它可以让程序运行的更快【因为它真的可以并发，所以如果程序是多线程方式书写，就可以更高效的执行】

### 指令级并行
在较低的抽象层次上，现代处理器可以同时执行多条指令的属性称为指令级并行。

1. 早期的微处理器，如1978年的Intel 8086，需要多个（通常是3-10个）时钟周期来执行一条指令
2. 最近的处理器【2016.11】可以保持每个时钟周期2-4条指令的执行速率
    1. 其实每条指令从开始到结束需要长的多的时间，大约20个或更多周期
    2. 但是处理器使用了非常多的技巧来同时处理多达100条指令
    3. 比如说流水线的使用，在流水线中，将执行一条执行所需要的活动划分成不同的步骤，将处理器的硬件组织成一系列的阶段，每个阶段执行一个步骤，这些阶段可以并行的操作，用来处理不同指令的部分部分

如果处理器可以达到比一个周期一条指令更快的执行速率，就称作**超标量处理器**

### 单指令、多数据并行
在最低层次上，许多现代处理器拥有特殊的硬件，允许一条指令产生多个可以并行执行的操作，这种方式称为**单指令、多数据**，即**SIMD**并行

# 计算机系统中抽象的重要性
1. **抽象**的使用是计算机科学中最重要的概念之一
    1. 比如，为一组函数规定一组简单的API就是一个良好的编程习惯，程序员可以无需了解其内部实现使用这些代码

计算机系统中使用的几个抽象：
1. 处理器中，指令集架构提供了对实际处理器硬件的抽象
    1. 使用这个抽象，机器代码程序表现得就好像运行在 一次只执行一条指令的处理器上
    2. 底层的硬件远比抽象描述的要复杂精细，它并行的执行多条指令，但却总是与那个简单有序的模型保持一致
    3. 只要执行模型一致，不同的处理器也可以执行同样的机器代码，而又提供不同的开销和性能
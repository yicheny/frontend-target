[TOC]

# 中断信息
CPU执行当前指令时，如果检测到某种特殊信息，CPU必须**立即**对这种信息进行处理。这种特殊信息就是中断信息，中断信息的意思就是接收到这种信息之后CPU必须要中断对当前程序的执行，优先处理这种特殊信息

中断信息可以来自CPU内部，也可以来自外部，本章主要介绍来自CPU内部的中断，简称内中断。

# 内中断
以下4种情况属于内中断：
1. 除法错误【比如溢出】
2. 单步执行
3. 执行int0指令
4. 执行int指令

这4种情况会产生4种不同的中断信息，CPU使用**中断类型码**标记中断信息类型。

中断类型码是字节型数据，所以最多可以表示256种不同类型的中断信息。

1. 除法错误，0
2. 单步执行，1
3. int0，4
3. int n，n

# 中断处理程序
CPU收到中断信息类型时，需要对中断信息进行处理，处理中断信息的程序被叫做**中断处理程序**

# 中断向量表
中断向量表是中断程序入口地址组成的列表，通过中断向量表可以找到对应的中断程序入口地址

8086CPU中，中断向量表被存放在0000:0000到0000:03E8这1000个内存单元中，这个存放区是**固定不可变**的

一个入口地址有2个字组成，高地址字存放段地址，低地址字存放偏移地址

# 中断过程
1. 程序异常，抛出中断类型码
2. 通过中断类型码从中断向量表中找到中断处理程序入口地址
3. 使用找到的入口地址设置CS和IP

以上是中断过程的主要流程，不过有一点需要注意：处理完中断之后程序需要回到原来的地址继续执行指令，所以需要将原来的CS和IP进行保存。

详细处理流程【8086】：
1. （从中断信息中）取得中断类型码
2. 标志寄存器的值入栈（在中断过程中会改变标志寄存器的值，所以需要先保存在栈中）
3. 设置标志寄存器的TF、IF为0（？）
4. CS入栈
5. IP入栈
6. 从内存地址为 `中断类型码*4` 读取入口程序偏移地址设置 IP
7. 从内存地址为 `中断类型码*4+2` 读取入口程序段地址设置 CS

代码描述：
1. 取得中断类型码 N
2. pushf
3. TF=0，IF=0
4. push CS
5. push IP
6. (IP)=(N*4)
7. (CS)=(N*4+2)
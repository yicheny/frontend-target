[TOC]

# 使用表驱动法的两个问题
1. 怎么从表中查询条目？
    1. 有一些数据可以用来直接访问表，比如如果希望数据按月分类，可以建月份表
    2. 另一些数据难以直接用于访问表，比如说我们想按身高分类，但是身高划分粒度是`0.01`，而且很难确定最高值。此时我们可以采用更复杂的方案
        1. 直接访问
        2. 索引访问
        3. 阶梯访问
2. 应该在表里存什么？
    1. 数据
    2. 函数

# 直接访问
```js
date = [31,28,31,30,31,30,31,31,30,31,30,31][month-1];
```

# 问题：保险费率
需求：
1. 1个计算医疗保险费率的程序
2. 费率随年龄、性别、婚姻、是否吸烟而变化

看一下原始写法
```js
if(gender === 'female'){
    if(maritalStatus === 'single'){
        if(smokingStatus === 'nonSmoking'){
            if(age < 18){
                rate = 200.00
            }
            else if( age === 18){
                rate = 250.00
            }
            else if( age === 19){
                rate = 300.00
            }
            //...
            else if(65 < age){
                rate = 450.00
            }
        }else{ 
            if(age < 18){
                rate = 250.00
            }
            else if(age === 18){
                rate = 300.00
            }
            else if(age === 19){
                rate = 350.00
            }
            //...
            else if(65 < age){
                rate = 575.00
            }
            
        }
    } else if(maritalStatus=== 'married' ){
        //...
    }
    //...
}
```
这里有4种状态相互影响，嵌套多达4层，即便我没有将所有代码写出，但我相信已足够大家想象这个代码的复杂程度。

我们使用表驱动法改写，这里我写的是`C++`写法（已实际测试过代码），用`C++`是因为它直接支持多数数组定义，比较方便：
```c++
enum Gender{
    Gender_Male,
    Gender_Female,
    Gender_Length
};

enum MaritalStatus{
    MaritalStatus_Single,
    MaritalStatus_Married,
    MaritalStatus_Length
};

enum SmokingStatus{
    SmokingStatus_Smoking,
    SmokingStatus_NonSmoking,
    SmokingStatus_Length
};

const int MAX_AGE = 125;

int rateArray[Gender_Length][MaritalStatus_Length][SmokingStatus_Length][MAX_AGE];
```
这样就创建一个四维数据表。

获取对应费率的时候这么取可以了：
```c++
int rate = rateArray[Gender_Female][MaritalStatus_Single][SmokingStatus_NonSmoking][17];
```
可以看到，原本超级复杂的逻辑没有了！

这种写法在代码简洁、性能、维护上都有了极大程度的提升。

下面我写一个ts版本的实现
```ts
enum Gender{
    Male,
    Female,
    Length
};

enum MaritalStatus{
    Single,
    Married,
    Length
};

enum SmokingStatus{
    Smoking,
    NonSmoking,
    Length
};


const MAX_AGE = 125;

const rateArray = createArray(Gender.Length, MaritalStatus.Length, SmokingStatus.Length, MAX_AGE)

function createArray(...lengthList){
    if(lengthList.length === 0) return [];
    return Array.from(Array(lengthList.shift()),() => createArray(...lengthList))
}
```
因为`js`原生没有直接创建多维数组的方法，我这里写了一个工具方法创建。

获取对应费率的时候这么取可以了：
```js
const rate = rateArray[Gender.Female][MaritalStatus.Single][SmokingStatus.NonSmoking][17];
```

# 双绞线

通常顺着网线会进入局域网，而后进入互联网，这里介绍局域网中的传输情况。

网线一般分为双绞线线和光纤，互联网一般都使用光纤，因为有超远距离传输的需要，局域网通常使用双绞线。

那么首先我们了解下什么是双绞线？以及为什么需要做成双绞线。

双绞线就是两条线通过环绕的方式绞在一起，所以叫做双绞线。

那么为什么需要做成双绞线呢？这样做明显需要的材料更多啊，因为需要解决噪声问题。

使用电信号进行传输时，如果周围有金属，会发生电磁反应，从而导致信号失真，这是情况之一。

另一种情况时，传输线之间相互也会有噪音，理论上这种噪音不大，但是相互之间太近了，所以也会造成影响。

而双绞线这种特殊的环绕方式，两根线之间相互抵消内部及外部的噪声影响。

# 集线器

集线器是对以太网基本架构的忠实实现，简单来说就是集线器会连接许多机器，信号传输给集线器之后，集线器会通过广播【ARP协议】将信号传输给所有连接的机器，然后机器校验包内容，只留下和自己匹配的，其他机器丢弃包。

集线器的这种方式，导致一个机器发送信号时，其他所有机器不能再发送，否则就会发生信号碰撞，所以这种模式叫做半双工

# 交换机

交换机可以认为是集线器的升级版，我是这么理解的。

交换机和集线器一样，同时连接了多台网络设备，每台设备连接着一个交换机端口。

信号传输到交换机端口后，MAU/PHY模块会将信号转换为通用信号，然后传给MAC模块将其转换为数字信号，MAC模块会通过FCS码校验数据，没问题的话就存储到缓存区中，这一部分内容和计算机网卡的作用是相同的，可以认为交换机的接口及其电路组成的端口实质上对应着计算机的网卡部分，不过不同的是，计算机的网卡含有mac地址，而交换机端口则没有mac地址，但是它们所作的事情是一样的。

交换机会从缓存区取出数据，通过数据的mac地址部分将其转发给对应的端口，刚刚说了端口没有mac地址，但是端口必然连接着网络设备，网络设备有自己的mac地址，这就足够了。

在最开始的时候，交换机中没有mac地址表，接收到数据之后会通过广播的方式发送给所有端口，一旦有端口接收数据并响应，这个时候交换机就可以将mac地址记录，下一次发送时直接发送给对应的端口，而无需广播。

除了广播的时候可以获取mac地址，接收数据里包含发送发的mac地址，此时也会将mac地址和端口对应存存储到mac地址表上。

另外就是，如果其中某个mac地址一段时间不用，那么交换机会删除地址表的这个地址，比如说有人在公司连接了交换机，但是下班后他拔掉网线，这个时候对应的mac地址就不在响应端口了，所以需要处理掉。

可以看到，对于交换机的mac地址表，交换机会自动维护，不需要手动维护，另外说一下，如果地址表出现问题，直接重启交换机即可重置mac地址表。

关于交换机，这里说一下双全工的事情，之前说集线器是半双工模式，交换机可以实现双全工，意思是不仅是同时发送和接收，还可以一次转发多个不同的信号。

其原因在于交换机是通过电子电路实现的通信控制，可以认为有一系列控制传输的开关，通过控制开关闭合，就可以将信号从指定端口传输给另一指定端口，这一操作可以同时进行，且不会相互影响，而且这一系列开关电路是电子电路，所以切换速度极快。

另外想要实现双全工通信，必须通信双方都支持双全工，其中一方是半全工，则通信就是半全工，原本设计这个是手动设置的，不过后来发现太麻烦做成了自动调整，交换机不仅可以自动切换半全工和双全工，而且会自动调整网络速率，使其达到最佳速率。因为网络传输中，不仅支持的通信模式不同，其传输速度也会存在差异，比如一方是100MB/S，另一方是200MB/S，这个时候最理想的通信速度是100MB/S，或快或慢都会造成不同程度的问题。

# 路由器

路由器和交换机的主要不同在于，路由是对ip协议的实现，交换机是对以太网协议的实现，路由转发是以ip为基准的，交换机转发是以mac地址为基准的。

这一点根本性不同，将会导致其他不同点的产生。

以交换机的广播机制而言，交换机在不知道mac地址的时候，可以直接广播然后通过响应信息得知mac地址。交换机最多连接几千台设备，这个成本并不是很高，而路由器呢？它是基于ip进行设计的，没法这么广播。

那么问题来了，路由器是怎么基于ip进行转发的呢？

| 目标地址         | 子网掩码| 网关 | 接口  | 跃点数【TTL】 | 
|--------------|---| --- |---| --- |
| 10.10.1.0    | 255.255.255.0   | —— | e2  | 1 | 
| 10.10.1.101  | 255.255.255.255 | —— | e2  | 1 | 
| 192.168.1.0  | 255.255.255.0   | —— | e3  | 1 |
| 192.168.1.10 | 255.255.255.255   | —— | e3  | 1 |
| 0.0.0.0      | 0.0.0.0   | 192.0.2.1 | e1  | 1 | 
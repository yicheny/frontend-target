
局域网路由器将网络包通过网关发送后并没有直接进入互联网，而是先发送到接入网，然后经接入网进入互联网。

这里我们得说一下互联网和局域网得不同。

从抽象的角度考虑，互联网的原理和局域网是相同，同样是通过路由器和ip进行转发。

不过也有一些不同，其一是距离，局域网距离很近，所以传输线很短就可以满足需要，但是互联网不行，互联网距离相差很远，比如说我可能需要将数据从中国传到美国，那么局域网短短几十米的传输线根本就满足不了需要。

其二是路由器数量，局域网内路由器数量相对可控，而互联网中存在数十万台路由器，而且随着时间日益增长中，所以互联网中的路由表维护策略和局域网策略是不同的，至少它不能手动维护是不是？另外虽然局域网也有自动维护路由表的策略，不过互联网的维护策略和局域网策略是不同的。【为什么？】

现在回到接入网，接入网有很多类型，比如电话线、ADSL、FTTH这些，有些公司可能会使用专线，这里我介绍两种典型接入网：ADSL、FTTH

# ADSL
ADSL，即不对称数字用户线，是一种用架设在电线杆上的金属线进行高速通信的技术，因为它的上行速度（用户到互联网）和下行速度（互联网到用户）的速度不一致，故此得名。

通路过程：

局域网路由器
- MAC、IP
- 转换电信号发送

ADSL路由器
- 接收包
- MAC、POPoE、PPP

ADSL Modem
- 接收包
- 转换为ATM信元发送
- 转换为电信号并发送

调制技术就是将使用圆滑波形【弦形波】表示数字的技术，主要有振幅调制和相位调制两种

同时，调制解决了方形信号容易失真受损的问题

而且，调制会使用多个频段进行信号传输，在不容易产生噪音的低频会多传信息，在容易产生噪音的高频会少传信息。

分离器
- 接收信号
- 分离电话信号和ATM信元发送

从分离器出来之后就是电话的接口，信号经过室内电话线，然后会到达大楼的IDF【中间配线盘】和MDF【主配线盘】，配线盘之后是保安器，在之后就是电线杆上架构的电缆。

然后说一下电缆，电缆 -> 单元 -> 子单元 -> 四芯电话线，四芯电话线中相对的两个线组成一条线路。

电缆传输时通常假设在电线杆上，在住宅区附近时可以的，然而电话局是汇总点，如果架设电话杆那么会密密麻麻的都堆在一起，很占据空间，而且会引发防灾方面的隐患，所以实际电缆在电话局汇总时并不是通过电线杆，而是埋在地下进行传输的，很多电缆放在一起就形成了电缆隧道，电缆隧道就是用于拜访电缆的通道。

DSLAM
- 接收电信号
- 将电信号转换为信元发送

BAS
- 接收信元
- 将信元转换为网络包
- 取出PPP包
- 添加隧道头部
- 发送

隧道路由器
- 接收隧道包
- 取出ip包
- 发送给互联网内部

## 流程概览
1. 内网路由器
   1. 添加IP头部
   2. 添加MAC头部并发送
2. 接入网路由器
   1. 接受包
   2. 取出IP包
   3. 添加MAC、PPPoE、PPP头部
3. ADSL Modem
   1. 接收包
   2. 拆分为ATM信元
   3. 转换为电信号并发送 
4. DSLAM
   1. 接收电信号
   2. 转换为ATM信元并发送
5. BAS
   1. 接收ATM信元
   2. 还原为网络包
   3. 取出PPP包
   4. 添加隧道头部并发送（如L2TP隧道）
6. 路由器（隧道专用）
   1. 接收隧道包
   2. 取出IP包
   3. 发送到互联网内部

# FTTH
## 什么是光纤？

双层结构的纤维状透明材质构成【玻璃和塑料】，通过里面的纤芯传导光信号来传输信息，通过明暗表示0、1

## 通信原理

数字信号转电信号，0转为低电压、1转为高电压，然后接入LED、激光二极管这一类光源，则低电压发光暗，高电压发光亮，然后随着光纤到达接收端，接收端是光敏材料，亮光则产生高电压，暗光则产生低电压，然后将电信号转换为数字信号

## 单模和多模
光的传导收折射率和透光率影响，简单的说就是发射角度越小，越容易进行折射，相反，发射角度越大，越容易投射出去。

然后是相位，和水波类似，相反的相位光波会相互抵消，所以光传导要求相位必须相同。

光的传导受很多方面影响，比如说材质不同，透光率、折射率有很大差别；其中材质不变的情况下，纤芯直径影响最大。

原因就在于光纤越粗，就可以接收发射角度更大的光，如此一来可以发射更多的光，相反的，越细的纤芯对发射角度越严格，可以发射的光越少。

所谓单模和多模，就是指可以一次发射单个光源还是多个光源。

多模因为角度不同，到达时间会所有差异，同时，光波宽度也会因角度而产生差异，所以多模并不适合超长距离传输，FTTH使用的是单模光纤。

## 直连和分路
FTTP有两种方式，第一种是直连，就是用户和电话局通过一根光纤直接连接，发送方这边会有一个光纤收发器将以太网电信号转化为光信号，电话局则是有一个多路光纤收发器，将多个用户的光信号接收并转换为电信号传输给互联网。

传输时一根光纤会同时接发信号，这里上行和下行会使用不同波长的光，所以无需担心光混合的问题，这里会使用滤波器将其分离【棱镜原理】，这里在一个光纤中使用不同波长的光波传输多种信号的方式叫做**波分复用**

另一种是分路，就是用户信息会发送到分光器，分光器将信号传输到ONU由其统一处理为光信号发送给电话局，电话局这边使用OLT将其转换为电信号传给互联网。

本质上ONU、OLT和光纤收发器做的事是相同的，只是ONU、OLT需要处理信号碰撞的问题，因为这里同时收发多个用户的信息，所以可能会发生信息碰撞。

## 流程概览
1. 内网路由器
   1. 添加IP头部
   2. 添加MAC头部并发送
2. 接入网路由器
   1. 接受包
   2. 取出IP包
   3. 添加MAC、PPPoE、PPP头部
3. 光纤收发器/ONU
   1. 接收包
   3. 转换为光信号并发送
4. 多路光纤收发器/OLT
   1. 接收光信号
   2. 转换为电信号并发送
5. BAS
   1. 接收包
   2. 取出PPP包
   3. 添加隧道头部并发送（如L2TP隧道）
6. 路由器（隧道专用）
   1. 接收隧道包
   2. 取出IP包
   3. 发送到互联网内部

# BAS
BAS是什么？从刚刚的流程里我说了它负责接收包，取出PPP包，然后在IP包加上隧道头部发给隧道路由器

然而实际上它还肩负着另一个重要责任，对PPP包的处理就是它负责的，BAS是具有更强大功能的高阶路由器。

首先说一下PPP，PPP集成了用户认证、配置下发、数据压缩、加密等功能，主要是用户认证，PPP里面含有用户信息和密码，BAS负责将PPP信息传给认证服务器，通过验证后，认证服务器将对应的ip地址等配置传给用户，用户需要使用这些配置完成配置，拥有了公网ip之后才能在互联网中传输数据。

通过这种方式配置公网ip是灵活的，首先我们知道必须有公网ip才能在互联网中进行传输，所以需要配置公网ip，我们知道计算机本身没有ip地址，通过账户和密码的方式分配ip的优点在于

# 名词
- **ADSL**：Asymmetric Digital Subscriber Line，不对称数字用户线。它是一种
利用架设在电线杆上的金属电话线来进行高速通信的技术，它的上行方向
（用户到互联网）和下行方向（互联网到用户）的通信速率是不对称的。
- **FTTH**：Fiber To The Home，光纤到户。指的是将光纤接入家庭的意思、
- **ATM**：Asynchronous Transfer Mode，异步传输。它是在以电话线为载体的 传统电话技术基础上扩展出来的一种通信方式。它的数据传输是以“信元”为单位来进行的，这和以包为单位传输数据的 TCP/IP 很像，但这种方式并不适用于计算机通信。
- **PPP**：Point-to-Point Protocol，点到点协议。它是电话线、ISDN 等通信线路所
  使用的一种协议，集成了用户认证、配置下发、数据压缩、加密等各种功能。